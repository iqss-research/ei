set.seed(1)
data(sample_ei)
formula <- t ~ x
dbuf <- ei(formula = formula, total = "n", data = sample_ei)

test_that("eiread betab works", {
  expect_equal(
    eiread(dbuf, "betab"),
    c(
      0.1967, 0.126, 0.1977, 0.2884, 0.1601, 0.183, 0.1018, 0.1011,
      0.2265, 0.2224, 0.1922, 0.2196, 0.1946, 0.1984, 0.2123, 0.1872,
      0.2849, 0.17, 0.1511, 0.1016, 0.3272, 0.2069, 0.2417, 0.21, 0.4095,
      0.1794, 0.2061, 0.4091, 0.2229, 0.1999, 0.216, 0.1801, 0.1838,
      0.2167, 0.21, 0.1652, 0.2101, 0.3853, 0.2284, 0.2667, 0.1962,
      0.174, 0.1929, 0.1028, 0.1251, 0.1408, 0.2205, 0.2088, 0.134,
      0.1518, 0.2411, 0.1788, 0.2238, 0.2158, 0.2174, 0.1805, 0.2182,
      0.2527, 0.2914, 0.2195, 0.2151, 0.1348, 0.2337, 0.1888, 0.1167,
      0.1703, 0.1736, 0.3805, 0.2241, 0.0365, 0.2801, 0.1574, 0.1974,
      0.202, 0.2977
    )
  )
})

test_that("eiread betaw works", {
  expect_equal(
    eiread(dbuf, "betaw"),
    c(
      0.6911, 0.6963, 0.6224, 0.8793, 0.5445, 0.3708, 0.5252, 0.5575,
      0.7836, 0.9071, 0.5832, 0.9285, 0.5908, 0.7392, 0.7636, 0.7146,
      0.7389, 0.7, 0.6843, 0.6849, 0.8713, 0.8747, 0.7925, 0.7177,
      0.8017, 0.6198, 0.5592, 0.947, 0.7199, 0.7645, 0.7714, 0.7062,
      0.6761, 0.9281, 0.78, 0.5878, 0.6775, 0.7791, 0.7248, 0.8173,
      0.6486, 0.7151, 0.7358, 0.666, 0.5357, 0.4844, 0.7293, 0.7676,
      0.661, 0.6167, 0.8801, 0.6585, 0.7527, 0.7428, 0.8869, 0.6762,
      0.8567, 0.7617, 0.8256, 0.7105, 0.7051, 0.6829, 0.7463, 0.5884,
      0.6227, 0.6609, 0.5378, 0.8702, 0.7405, 0.5047, 0.7284, 0.6975,
      0.68, 0.4631, 0.9764
    )
  )
})

test_that("eiread phi works", {
  expect_equal(
    eiread(dbuf, "phi"),
    c(-1.1606, 0.8264, -2.1411, -1.8074, 0.0316, 0, 0)
  )
})

test_that("eiread sbetab works", {
  expect_equal(
    eiread(dbuf, "sbetab"),
    c(
      0.1085, 0.052, 0.1065, 0.0735, 0.0925, 0.095, 0.0703, 0.0725,
      0.1098, 0.1068, 0.0988, 0.1153, 0.102, 0.0938, 0.1043, 0.1042,
      0.0157, 0.0521, 0.0257, 0.0129, 0.072, 0.1133, 0.0986, 0.1064,
      0.0296, 0.0999, 0.1073, 0.0593, 0.0587, 0.1135, 0.1005, 0.0797,
      0.0355, 0.1055, 0.1034, 0.0868, 0.1136, 0.0337, 0.0141, 0.0938,
      0.1118, 0.1047, 0.0976, 0.0486, 0.0704, 0.0838, 0.0569, 0.1192,
      0.0477, 0.0879, 0.105, 0.08, 0.0682, 0.0975, 0.102, 0.098, 0.1129,
      0.0417, 0.0741, 0.1066, 0.0181, 0.0552, 0.0269, 0.1073, 0.0622,
      0.0916, 0.1033, 0.0632, 0.0071, 0.0271, 0.0231, 0.0038, 0.0959,
      0.1006, 0.0749
    )
  )
})

test_that("eiread sbetaw works", {
  expect_equal(
    eiread(dbuf, "sbetaw"),
    c(
      0.0051, 0.1307, 0.0162, 0.0638, 0.0655, 0.0134, 0.0953, 0.105,
      0.0209, 0.0243, 0.0012, 0.0088, 0.0265, 0.0502, 1e-04, 0.0444,
      0.1537, 0.1219, 0.1721, 0.1612, 0.0805, 0.0027, 0.0798, 7e-04,
      0.1166, 0.0625, 0.0218, 0.0442, 0.1299, 0.0095, 0.0457, 0.1032,
      0.1469, 2e-04, 0.0641, 0.0586, 0.0021, 0.1367, 0.1459, 0.1089,
      0.037, 0.0569, 0.0233, 0.1661, 0.0783, 0.057, 0.1372, 0.0479,
      0.1271, 0.0837, 0.0372, 0.0903, 0.1112, 0.0598, 0.0126, 0.0534,
      0.0155, 0.1163, 0.0945, 0.003, 0.1464, 0.1247, 0.146, 0.0187,
      0.1214, 0.1072, 0.0366, 0.0899, 0.1516, 0.0904, 0.1482, 0.1532,
      0.0052, 0.0115, 0.0182
    )
  )
})

test_that("eiread psisims works", {
  expect_equal(
    eiread(dbuf, "psisims")[, 1],
    c(
      0.177, 0.2172, 0.204, 0.185, 0.1396, 0.1766, 0.1518, 0.1945,
      0.1949, 0.2, 0.2114, 0.1419, 0.2011, 0.2151, 0.2008, 0.1577,
      0.1945, 0.2264, 0.1615, 0.1624, 0.1768, 0.167, 0.1881, 0.192,
      0.1611, 0.1751, 0.1532, 0.1599, 0.1597, 0.2118, 0.2047, 0.2021,
      0.1634, 0.1593, 0.2211, 0.1773, 0.1471, 0.1486, 0.2003, 0.1949,
      0.1908, 0.1503, 0.1904, 0.226, 0.1748, 0.229, 0.1982, 0.2049,
      0.1891, 0.1924, 0.2048, 0.1919, 0.1778, 0.1617, 0.1652, 0.2072,
      0.2001, 0.1672, 0.1655, 0.1867, 0.2181, 0.1783, 0.2255, 0.2005,
      0.1851, 0.2001, 0.1666, 0.1915, 0.1925, 0.2018, 0.1584, 0.1883,
      0.2077, 0.2241, 0.22, 0.1875, 0.1731, 0.1845, 0.2038, 0.1479,
      0.1618, 0.1935, 0.2237, 0.1846, 0.1944, 0.2186, 0.2052, 0.2145,
      0.2035, 0.1913, 0.2183, 0.2184, 0.1867, 0.2026, 0.2147, 0.2017,
      0.1763, 0.1811, 0.1734
    )
  )
})

test_that("eiread bounds works", {
  expect_equal(
    eiread(dbuf, "bounds"),
    structure(c(
      0, 0.0051, 0, 0.1495, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0.2582, 0.0416, 0.1038, 0.0763, 0.212, 0, 0, 0, 0.3591,
      0, 0, 0.338, 0.0964, 0, 0, 0, 0.1055, 0, 0, 0, 0, 0.3308, 0.2018,
      0.1092, 0, 0, 0, 0.005, 0, 0, 0.1082, 0, 0.0067, 0, 0, 0, 0.0722,
      0, 0, 0, 0, 0.1673, 0.1546, 0, 0.1785, 0, 0.1869, 0, 0, 0, 0,
      0.2892, 0.2119, 0, 0.2377, 0.1497, 0, 0, 0.201, 1, 0.4033, 1,
      1, 0.9293, 1, 0.4889, 0.4865, 1, 1, 1, 1, 1, 1, 1, 1, 0.3604,
      0.4696, 0.2536, 0.1566, 1, 1, 1, 1, 0.6135, 1, 1, 1, 0.5484,
      1, 1, 0.7256, 0.3473, 1, 1, 1, 1, 0.5774, 0.2986, 0.9711, 1,
      1, 1, 0.298, 0.6071, 0.8534, 0.523, 1, 0.3824, 0.7991, 1, 0.7622,
      0.6854, 1, 1, 1, 1, 0.5256, 0.9388, 1, 0.3024, 0.4373, 0.3712,
      1, 0.4358, 0.7351, 1, 0.9919, 0.2588, 0.1881, 0.3937, 0.1751,
      1, 1, 1, 0.6534, 0, 0.5, 0.2617, 0, 0.2549, 0, 0, 0.6362, 0.7299,
      0.5731, 0.8683, 0.3817, 0.3101, 0.7625, 0.3686, 0, 0, 0, 0, 0.1196,
      0.8557, 0.179, 0.7118, 0, 0.1066, 0.3974, 0.5065, 0, 0.6969,
      0.4144, 0, 0, 0.9266, 0.2902, 0.0246, 0.6624, 0, 0, 0, 0.3821,
      0.2657, 0.5431, 0, 0, 0, 0, 0.4493, 0, 0, 0.6111, 0, 0, 0.2614,
      0.7899, 0.2297, 0.749, 0, 0, 0.688, 0, 0, 0, 0.4464, 0, 0, 0.2444,
      0, 0, 0, 0, 0, 0.6364, 0.3713, 0.8052, 0.7004, 1, 0.6526, 1,
      0.6578, 0.3967, 0.6634, 0.7039, 0.8268, 0.9578, 0.5856, 0.9454,
      0.6413, 0.8455, 0.7639, 0.7944, 1, 1, 1, 1, 1, 0.8797, 0.988,
      0.7192, 1, 0.7321, 0.6013, 1, 1, 0.7814, 0.8698, 0.9394, 1, 0.9285,
      0.9102, 0.6993, 0.6815, 1, 1, 1, 0.7137, 0.8099, 0.7819, 1, 0.6748,
      0.5802, 1, 0.8516, 1, 0.7613, 0.9655, 0.8605, 1, 0.8754, 0.9139,
      0.7746, 0.8867, 1, 1, 0.7169, 1, 0.9872, 1, 0.6215, 0.8506, 0.8602,
      0.5994, 1, 1, 0.6264, 1, 1, 0.6907, 0.4863, 1
    ),
    .Dim = c(75L, 4L),
    .Dimnames = list(NULL, c("LbetaB", "UbetaB", "LbetaW", "UbetaW"))
    )
  )
})

test_that("eiread CI80b works", {
  expect_equal(
    eiread(dbuf, "CI80b"),
    structure(c(
      0.0513, 0.0735, 0.0653, 0.1955, 0.044, 0.0727, 0.0185,
      0.0124, 0.09, 0.0731, 0.0486, 0.0849, 0.0435, 0.0802, 0.0801,
      0.0598, 0.2653, 0.1071, 0.1193, 0.0861, 0.2371, 0.0696, 0.1153,
      0.0733, 0.3743, 0.0393, 0.0757, 0.3496, 0.1343, 0.0614, 0.102,
      0.0696, 0.1363, 0.0589, 0.0804, 0.0539, 0.0636, 0.3465, 0.2102,
      0.1472, 0.0548, 0.0512, 0.0757, 0.0413, 0.0383, 0.0398, 0.1461,
      0.0406, 0.0711, 0.0384, 0.0805, 0.072, 0.1386, 0.0933, 0.0963,
      0.0508, 0.0614, 0.1984, 0.1925, 0.0837, 0.194, 0.0618, 0.2008,
      0.0612, 0.0334, 0.0512, 0.0185, 0.3023, 0.215, 0.0083, 0.2494,
      0.1523, 0.0738, 0.0786, 0.212, 0.3511, 0.1888, 0.3499, 0.3725,
      0.2789, 0.2945, 0.2016, 0.2093, 0.3824, 0.3486, 0.317, 0.3732,
      0.3237, 0.3216, 0.3554, 0.3222, 0.3083, 0.2317, 0.1888, 0.1192,
      0.4164, 0.3839, 0.3733, 0.3429, 0.4419, 0.3068, 0.3373, 0.5012,
      0.2974, 0.3565, 0.3426, 0.2764, 0.2258, 0.345, 0.3452, 0.265,
      0.3537, 0.4352, 0.2489, 0.3958, 0.3413, 0.3138, 0.331, 0.1669,
      0.2065, 0.262, 0.3013, 0.3841, 0.1955, 0.2705, 0.3473, 0.291,
      0.313, 0.3358, 0.3199, 0.3104, 0.3926, 0.3126, 0.3932, 0.3607,
      0.2423, 0.2093, 0.2708, 0.3383, 0.1936, 0.2737, 0.2953, 0.4658,
      0.2335, 0.0712, 0.309, 0.1621, 0.3116, 0.3353, 0.3924
    ),
    .Dim = c(75L, 2L),
    .Dimnames = list(NULL, c("lwr", "upr"))
    )
  )
})

test_that("eiread CI80w works", {
  expect_equal(
    eiread(dbuf, "CI80w"),
    structure(c(
      0.6839, 0.5386, 0.5991, 0.8064, 0.4604, 0.355, 0.3897,
      0.401, 0.7539, 0.8784, 0.5816, 0.9167, 0.5573, 0.6733, 0.7634,
      0.6572, 0.51, 0.5559, 0.4325, 0.4662, 0.7716, 0.8705, 0.686,
      0.7167, 0.6745, 0.5401, 0.5325, 0.8783, 0.5552, 0.7513, 0.7138,
      0.5815, 0.5023, 0.9279, 0.6961, 0.5205, 0.6748, 0.5766, 0.5136,
      0.6675, 0.6005, 0.6391, 0.7028, 0.4473, 0.4452, 0.402, 0.5344,
      0.697, 0.4975, 0.5036, 0.8424, 0.5319, 0.6073, 0.6692, 0.8742,
      0.6054, 0.8326, 0.5944, 0.6956, 0.7065, 0.4847, 0.5147, 0.5452,
      0.5622, 0.4726, 0.5399, 0.4945, 0.7487, 0.54, 0.3893, 0.543,
      0.5114, 0.6738, 0.4478, 0.9533, 0.698, 0.8283, 0.6426, 0.96,
      0.6267, 0.3864, 0.6382, 0.6859, 0.8097, 0.9412, 0.585, 0.9389,
      0.63, 0.8025, 0.7638, 0.7689, 0.9303, 0.847, 0.8963, 0.878, 0.9719,
      0.878, 0.8947, 0.7187, 0.9402, 0.7075, 0.5858, 0.9914, 0.916,
      0.7762, 0.8234, 0.8492, 0.8725, 0.9284, 0.8603, 0.6629, 0.6803,
      0.9364, 0.9127, 0.956, 0.6955, 0.782, 0.7638, 0.8759, 0.6322,
      0.5531, 0.9086, 0.8352, 0.8286, 0.7247, 0.937, 0.7791, 0.8917,
      0.818, 0.9019, 0.7468, 0.8783, 0.913, 0.9516, 0.7145, 0.8746,
      0.8475, 0.9248, 0.6107, 0.7852, 0.8002, 0.5928, 0.9814, 0.9342,
      0.5987, 0.9253, 0.8943, 0.6867, 0.4773, 0.9973
    ),
    .Dim = c(75L, 2L),
    .Dimnames = list(NULL, c("lwr", "upr"))
    )
  )
})

test_that("eiread abounds works", {
  expect_equal(
    eiread(dbuf, "abounds"),
    structure(c(0.0954, 0.6089, 0.3979, 0.8031),
              .Dim = c(2L, 2L)
    )
  )
})

test_that("eiread aggs works", {
  expect_equal(
    eiread(dbuf, "aggs"),
    structure(c(
      0.1963, 0.2135, 0.219, 0.1935, 0.1963, 0.2029, 0.19,
      0.1991, 0.2373, 0.1997, 0.2114, 0.2071, 0.2019, 0.2193, 0.2118,
      0.1917, 0.2182, 0.2285, 0.2056, 0.1857, 0.1905, 0.2047, 0.1943,
      0.2228, 0.1966, 0.2098, 0.2044, 0.1967, 0.2044, 0.2069, 0.2083,
      0.207, 0.1845, 0.2023, 0.2276, 0.215, 0.1831, 0.2, 0.2184, 0.2265,
      0.197, 0.1942, 0.2174, 0.216, 0.1838, 0.2097, 0.1962, 0.2035,
      0.2215, 0.2056, 0.2077, 0.2008, 0.2168, 0.1888, 0.2133, 0.2245,
      0.2072, 0.1926, 0.1885, 0.1988, 0.2093, 0.2185, 0.21, 0.2089,
      0.2077, 0.2042, 0.2037, 0.2043, 0.2085, 0.209, 0.2021, 0.1937,
      0.2094, 0.2175, 0.2089, 0.2063, 0.1985, 0.1872, 0.2184, 0.186,
      0.1959, 0.2011, 0.2096, 0.2031, 0.2117, 0.2188, 0.2307, 0.2138,
      0.213, 0.2099, 0.2084, 0.2074, 0.2065, 0.1902, 0.2325, 0.2049,
      0.1865, 0.2157, 0.2038, 0.7235, 0.7099, 0.7055, 0.7257, 0.7235,
      0.7183, 0.7285, 0.7213, 0.6911, 0.7208, 0.7116, 0.715, 0.7191,
      0.7053, 0.7113, 0.7271, 0.7062, 0.6981, 0.7162, 0.7318, 0.728,
      0.7169, 0.7251, 0.7026, 0.7233, 0.7129, 0.7171, 0.7232, 0.7171,
      0.7151, 0.7141, 0.7151, 0.7328, 0.7187, 0.6988, 0.7087, 0.7339,
      0.7206, 0.706, 0.6997, 0.723, 0.7252, 0.7068, 0.708, 0.7334,
      0.7129, 0.7236, 0.7178, 0.7036, 0.7161, 0.7145, 0.7199, 0.7074,
      0.7294, 0.7101, 0.7012, 0.7149, 0.7264, 0.7296, 0.7215, 0.7132,
      0.706, 0.7126, 0.7136, 0.7145, 0.7172, 0.7176, 0.7171, 0.7138,
      0.7135, 0.7189, 0.7256, 0.7131, 0.7068, 0.7136, 0.7156, 0.7217,
      0.7307, 0.7061, 0.7316, 0.7238, 0.7197, 0.713, 0.7181, 0.7114,
      0.7057, 0.6964, 0.7097, 0.7103, 0.7128, 0.7139, 0.7147, 0.7155,
      0.7283, 0.695, 0.7167, 0.7312, 0.7082, 0.7176
    ),
    .Dim = c(99L, 2L),
    .Dimnames = list(NULL, c("Bbgg", "Bwgg"))
    )
  )
})

test_that("eiread maggs works", {
  expect_equal(
    eiread(dbuf, "maggs"),
    c(0.206, 0.7159, 0.0115, 0.0091)
  )
})

test_that("eiread VCaggs works", {
  expect_equal(
    eiread(dbuf, "VCaggs"),
    structure(c(1e-04, -2e-04, -2e-04, 0),
              .Dim = c(2L, 2L)
    )
  )
})

# test_that("eiread eaggbias works", {
#   expect_equal(eiread(dbuf, "eaggbias"),
#                structure(c(1e-04, -2e-04, -2e-04, 0),
#                          .Dim = c(2L, 2L))
#   )
# })

test_that("eiread goodman works", {
  expect_equal(
    eiread(dbuf, "goodman"),
    structure(c(0.1956, 0.7228, 0.0275, 0.023, 7.0995, 31.3996, 0, 0),
              .Dim = c(2L, 4L),
              .Dimnames = list(
                c("BetaB", "BetaW"),
                c("Estimate", "Std. Error", "t value", "Pr(>|t|)")
              )
    )
  )
})
