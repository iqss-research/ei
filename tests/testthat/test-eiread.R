set.seed(1)
data(sample_ei)
formula <- t ~ x
dbuf <- ei(formula = formula, total = "n", data = sample_ei)

test_that("eiread betab works", {
  expect_equal(
    eiread(dbuf, "betab"),
    c(
      0.2006, 0.1443, 0.1823, 0.282, 0.1281, 0.1241, 0.0991, 0.1005,
      0.2235, 0.2651, 0.182, 0.2584, 0.1784, 0.1914, 0.2113, 0.1839,
      0.2851, 0.176, 0.1491, 0.1041, 0.3169, 0.2356, 0.2377, 0.1952,
      0.3946, 0.1753, 0.1617, 0.3898, 0.2048, 0.1953, 0.2219, 0.1737,
      0.1801, 0.2615, 0.2129, 0.1477, 0.2117, 0.3709, 0.2275, 0.2607,
      0.1807, 0.1922, 0.2002, 0.1126, 0.1148, 0.1177, 0.2124, 0.1986,
      0.1352, 0.1438, 0.2414, 0.1648, 0.2241, 0.2111, 0.2495, 0.1796,
      0.2362, 0.2469, 0.2785, 0.2122, 0.2139, 0.1453, 0.229, 0.1818,
      0.125, 0.1569, 0.1454, 0.3576, 0.2247, 0.0378, 0.2722, 0.158,
      0.2046, 0.1466, 0.3076
    )
  )
})

test_that("eiread betaw works", {
  expect_equal(
    eiread(dbuf, "betaw"),
    c(
      0.691, 0.6503, 0.6247, 0.8849, 0.5671, 0.3791, 0.5289, 0.5585,
      0.7842, 0.8974, 0.5833, 0.9255, 0.595, 0.743, 0.7636, 0.7161,
      0.7363, 0.686, 0.6974, 0.6544, 0.8828, 0.8741, 0.7957, 0.7178,
      0.8602, 0.6224, 0.5683, 0.9614, 0.76, 0.7649, 0.7688, 0.7144,
      0.6914, 0.928, 0.7782, 0.5996, 0.6775, 0.8371, 0.7343, 0.8242,
      0.6537, 0.7052, 0.7341, 0.6326, 0.5471, 0.5001, 0.7487, 0.7717,
      0.658, 0.6243, 0.8799, 0.6744, 0.7522, 0.7457, 0.8829, 0.6767,
      0.8542, 0.7777, 0.842, 0.7108, 0.7147, 0.6592, 0.7717, 0.5896,
      0.6065, 0.6765, 0.5478, 0.9026, 0.7273, 0.5004, 0.7788, 0.6708,
      0.6796, 0.4695, 0.974
    )
  )
})

test_that("eiread phi works", {
  expect_equal(
    eiread(dbuf, "phi"),
    c(-1.1535, 0.8217, -2.2862, -1.882, 0.4123, 0, 0)
  )
})

test_that("eiread sbetab works", {
  expect_equal(
    eiread(dbuf, "sbetab"),
    c(
      0.0965, 0.0442, 0.0949, 0.0737, 0.0678, 0.0842, 0.0536, 0.0547,
      0.0938, 0.1052, 0.0901, 0.099, 0.0876, 0.0826, 0.0951, 0.0916,
      0.0126, 0.0442, 0.0208, 0.0101, 0.0576, 0.1052, 0.0782, 0.0987,
      0.026, 0.0867, 0.0855, 0.0419, 0.0466, 0.1005, 0.0851, 0.0594,
      0.0276, 0.0984, 0.0788, 0.0862, 0.0813, 0.0256, 0.0118, 0.0618,
      0.0874, 0.0756, 0.0782, 0.0339, 0.0659, 0.0613, 0.0443, 0.0874,
      0.0406, 0.0656, 0.0955, 0.0668, 0.0615, 0.0747, 0.092, 0.0825,
      0.092, 0.0385, 0.0624, 0.0963, 0.0148, 0.0497, 0.0217, 0.1011,
      0.0491, 0.0747, 0.0704, 0.0509, 0.0053, 0.0246, 0.0188, 0.0034,
      0.0996, 0.0909, 0.0741
    )
  )
})

test_that("eiread sbetaw works", {
  expect_equal(
    eiread(dbuf, "sbetaw"),
    c(
      0.0045, 0.1111, 0.0144, 0.064, 0.048, 0.0119, 0.0727, 0.0792,
      0.0178, 0.0239, 0.0011, 0.0076, 0.0227, 0.0442, 1e-04, 0.039,
      0.1234, 0.1034, 0.139, 0.1261, 0.0644, 0.0025, 0.0633, 7e-04,
      0.1022, 0.0542, 0.0174, 0.0312, 0.1032, 0.0084, 0.0387, 0.0769,
      0.1144, 1e-04, 0.0488, 0.0581, 0.0015, 0.104, 0.1218, 0.0717,
      0.029, 0.0411, 0.0186, 0.1157, 0.0733, 0.0417, 0.1068, 0.0351,
      0.108, 0.0625, 0.0338, 0.0755, 0.1004, 0.0459, 0.0114, 0.0449,
      0.0126, 0.1074, 0.0796, 0.0027, 0.1202, 0.1123, 0.118, 0.0177,
      0.0958, 0.0874, 0.025, 0.0725, 0.1149, 0.082, 0.1207, 0.136,
      0.0054, 0.0104, 0.018
    )
  )
})

test_that("eiread psisims works", {
  expect_equal(
    eiread(dbuf, "psisims")[, 1],
    c(
      0.1848, 0.2167, 0.2089, 0.2394, 0.1937, 0.154, 0.1851, 0.1661,
      0.1984, 0.2223, 0.2013, 0.2014, 0.1608, 0.2148, 0.2087, 0.1712,
      0.2013, 0.2251, 0.1715, 0.1727, 0.1869, 0.1792, 0.2008, 0.1777,
      0.1832, 0.1678, 0.1716, 0.2144, 0.2073, 0.1739, 0.1743, 0.2393,
      0.225, 0.1876, 0.163, 0.165, 0.2048, 0.2021, 0.2013, 0.1615,
      0.1932, 0.2285, 0.1814, 0.2274, 0.2029, 0.2086, 0.1965, 0.1969,
      0.2087, 0.1993, 0.1857, 0.1737, 0.1775, 0.212, 0.2047, 0.1749,
      0.2004, 0.1755, 0.2145, 0.1953, 0.2223, 0.1876, 0.2267, 0.2054,
      0.2038, 0.1923, 0.206, 0.1769, 0.1989, 0.201, 0.2047, 0.1694,
      0.1963, 0.2096, 0.222, 0.2201, 0.193, 0.1839, 0.1913, 0.209,
      0.1649, 0.1728, 0.1983, 0.2095, 0.2257, 0.1929, 0.2008, 0.2199,
      0.2088, 0.2134, 0.2082, 0.1965, 0.2199, 0.2206, 0.1946, 0.2071,
      0.2171, 0.2072, 0.1858
    )
  )
})

test_that("eiread bounds works", {
  expect_equal(
    eiread(dbuf, "bounds"),
    structure(c(
      0, 0.0051, 0, 0.1495, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0.2582, 0.0416, 0.1038, 0.0763, 0.212, 0, 0, 0, 0.3591,
      0, 0, 0.338, 0.0964, 0, 0, 0, 0.1055, 0, 0, 0, 0, 0.3308, 0.2018,
      0.1092, 0, 0, 0, 0.005, 0, 0, 0.1082, 0, 0.0067, 0, 0, 0, 0.0722,
      0, 0, 0, 0, 0.1673, 0.1546, 0, 0.1785, 0, 0.1869, 0, 0, 0, 0,
      0.2892, 0.2119, 0, 0.2377, 0.1497, 0, 0, 0.201, 1, 0.4033, 1,
      1, 0.9293, 1, 0.4889, 0.4865, 1, 1, 1, 1, 1, 1, 1, 1, 0.3604,
      0.4696, 0.2536, 0.1566, 1, 1, 1, 1, 0.6135, 1, 1, 1, 0.5484,
      1, 1, 0.7256, 0.3473, 1, 1, 1, 1, 0.5774, 0.2986, 0.9711, 1,
      1, 1, 0.298, 0.6071, 0.8534, 0.523, 1, 0.3824, 0.7991, 1, 0.7622,
      0.6854, 1, 1, 1, 1, 0.5256, 0.9388, 1, 0.3024, 0.4373, 0.3712,
      1, 0.4358, 0.7351, 1, 0.9919, 0.2588, 0.1881, 0.3937, 0.1751,
      1, 1, 1, 0.6534, 0, 0.5, 0.2617, 0, 0.2549, 0, 0, 0.6362, 0.7299,
      0.5731, 0.8683, 0.3817, 0.3101, 0.7625, 0.3686, 0, 0, 0, 0, 0.1196,
      0.8557, 0.179, 0.7118, 0, 0.1066, 0.3974, 0.5065, 0, 0.6969,
      0.4144, 0, 0, 0.9266, 0.2902, 0.0246, 0.6624, 0, 0, 0, 0.3821,
      0.2657, 0.5431, 0, 0, 0, 0, 0.4493, 0, 0, 0.6111, 0, 0, 0.2614,
      0.7899, 0.2297, 0.749, 0, 0, 0.688, 0, 0, 0, 0.4464, 0, 0, 0.2444,
      0, 0, 0, 0, 0, 0.6364, 0.3713, 0.8052, 0.7004, 1, 0.6526, 1,
      0.6578, 0.3967, 0.6634, 0.7039, 0.8268, 0.9578, 0.5856, 0.9454,
      0.6413, 0.8455, 0.7639, 0.7944, 1, 1, 1, 1, 1, 0.8797, 0.988,
      0.7192, 1, 0.7321, 0.6013, 1, 1, 0.7814, 0.8698, 0.9394, 1, 0.9285,
      0.9102, 0.6993, 0.6815, 1, 1, 1, 0.7137, 0.8099, 0.7819, 1, 0.6748,
      0.5802, 1, 0.8516, 1, 0.7613, 0.9655, 0.8605, 1, 0.8754, 0.9139,
      0.7746, 0.8867, 1, 1, 0.7169, 1, 0.9872, 1, 0.6215, 0.8506, 0.8602,
      0.5994, 1, 1, 0.6264, 1, 1, 0.6907, 0.4863, 1
    ),
    .Dim = c(75L, 4L),
    .Dimnames = list(NULL, c("LbetaB", "UbetaB", "LbetaW", "UbetaW"))
    )
  )
})

test_that("eiread CI80b works", {
  expect_equal(
    eiread(dbuf, "CI80b"),
    structure(c(
      0.0914, 0.0815, 0.0641, 0.1971, 0.0427, 0.026, 0.0388,
      0.0338, 0.0917, 0.1464, 0.0683, 0.1089, 0.0723, 0.0818, 0.1079,
      0.0646, 0.2696, 0.1194, 0.1248, 0.0927, 0.2495, 0.1003, 0.1514,
      0.0635, 0.3655, 0.0585, 0.0412, 0.3437, 0.1422, 0.0541, 0.0994,
      0.0975, 0.14, 0.1591, 0.0997, 0.0312, 0.1101, 0.3415, 0.2126,
      0.1892, 0.0654, 0.0964, 0.0994, 0.0693, 0.0253, 0.0382, 0.1609,
      0.0992, 0.0817, 0.0661, 0.1109, 0.0683, 0.1459, 0.1124, 0.1377,
      0.0699, 0.1014, 0.1944, 0.1998, 0.1062, 0.1938, 0.0855, 0.2024,
      0.049, 0.0599, 0.0548, 0.0514, 0.2998, 0.2186, 0.0083, 0.2499,
      0.1533, 0.0765, 0.0313, 0.2189, 0.3237, 0.1964, 0.299, 0.3951,
      0.2136, 0.2442, 0.1784, 0.1668, 0.3395, 0.4082, 0.302, 0.3691,
      0.3021, 0.2951, 0.3356, 0.305, 0.3015, 0.2328, 0.1779, 0.1176,
      0.396, 0.3897, 0.319, 0.3204, 0.4389, 0.2737, 0.2678, 0.4455,
      0.2576, 0.343, 0.3381, 0.2399, 0.2156, 0.3818, 0.2946, 0.2644,
      0.313, 0.4087, 0.2427, 0.3413, 0.2852, 0.2907, 0.295, 0.152,
      0.2136, 0.2069, 0.2703, 0.2901, 0.1839, 0.2352, 0.3633, 0.2411,
      0.3036, 0.3021, 0.375, 0.2894, 0.3593, 0.2899, 0.356, 0.3136,
      0.2324, 0.2034, 0.2534, 0.3073, 0.1836, 0.2435, 0.2337, 0.4228,
      0.2321, 0.0706, 0.2943, 0.1625, 0.3451, 0.2846, 0.4118
    ),
    .Dim = c(75L, 2L),
    .Dimnames = list(NULL, c("lwr", "upr"))
    )
  )
})

test_that("eiread CI80w works", {
  expect_equal(
    eiread(dbuf, "CI80w"),
    structure(c(
      0.6852, 0.5196, 0.6069, 0.7867, 0.5066, 0.3621, 0.4213,
      0.4625, 0.7621, 0.8648, 0.5818, 0.917, 0.5629, 0.6874, 0.7634,
      0.6645, 0.5757, 0.5534, 0.5054, 0.486, 0.7943, 0.8703, 0.7299,
      0.7168, 0.6862, 0.5609, 0.5467, 0.9198, 0.6431, 0.7524, 0.7159,
      0.6288, 0.5446, 0.9278, 0.7276, 0.5209, 0.6755, 0.6838, 0.5776,
      0.7307, 0.6191, 0.6516, 0.7114, 0.4983, 0.4373, 0.4395, 0.6093,
      0.7349, 0.5282, 0.5372, 0.8367, 0.5883, 0.6226, 0.6899, 0.8674,
      0.6168, 0.8372, 0.6578, 0.7431, 0.7078, 0.5646, 0.528, 0.6395,
      0.5676, 0.4922, 0.5752, 0.5164, 0.8099, 0.5698, 0.3912, 0.6373,
      0.4962, 0.672, 0.4536, 0.9486, 0.6961, 0.8082, 0.6428, 0.9586,
      0.6276, 0.393, 0.6107, 0.655, 0.8094, 0.9244, 0.5848, 0.937,
      0.6226, 0.8017, 0.7638, 0.7668, 0.8887, 0.8183, 0.8598, 0.7953,
      0.9581, 0.8773, 0.8655, 0.7187, 0.9749, 0.6954, 0.5928, 0.9957,
      0.8986, 0.7769, 0.8245, 0.813, 0.8572, 0.9282, 0.8484, 0.6782,
      0.6794, 0.9564, 0.8883, 0.9072, 0.692, 0.7574, 0.7582, 0.7803,
      0.6466, 0.5542, 0.8729, 0.8117, 0.8003, 0.6983, 0.9262, 0.7833,
      0.8798, 0.8063, 0.8968, 0.7364, 0.8728, 0.9242, 0.9423, 0.7138,
      0.8763, 0.7942, 0.9163, 0.6129, 0.7336, 0.796, 0.5811, 0.9849,
      0.8587, 0.5985, 0.9222, 0.8576, 0.6866, 0.4827, 0.9956
    ),
    .Dim = c(75L, 2L),
    .Dimnames = list(NULL, c("lwr", "upr"))
    )
  )
})

test_that("eiread abounds works", {
  expect_equal(
    eiread(dbuf, "abounds"),
    structure(c(0.0954, 0.6089, 0.3979, 0.8031),
      .Dim = c(2L, 2L)
    )
  )
})

test_that("eiread aggs works", {
  expect_equal(
    eiread(dbuf, "aggs"),
    structure(c(
      0.1812, 0.2168, 0.2115, 0.2296, 0.1937, 0.1836, 0.1903,
      0.1792, 0.2074, 0.2073, 0.2086, 0.2044, 0.1752, 0.2051, 0.2097,
      0.2001, 0.208, 0.2122, 0.1958, 0.1986, 0.1843, 0.1969, 0.2035,
      0.1998, 0.1938, 0.1809, 0.2008, 0.2076, 0.206, 0.1875, 0.1832,
      0.215, 0.2063, 0.2091, 0.1871, 0.2077, 0.2184, 0.2191, 0.1806,
      0.1905, 0.2019, 0.2192, 0.191, 0.2126, 0.2081, 0.2128, 0.1941,
      0.2011, 0.1974, 0.1889, 0.2111, 0.1913, 0.2043, 0.2092, 0.2016,
      0.1793, 0.203, 0.1948, 0.2127, 0.1961, 0.2236, 0.2018, 0.2132,
      0.2122, 0.2172, 0.1838, 0.2059, 0.2138, 0.2028, 0.1885, 0.2056,
      0.199, 0.1856, 0.2088, 0.2172, 0.2151, 0.2019, 0.1906, 0.2063,
      0.2053, 0.1798, 0.2036, 0.196, 0.2001, 0.2049, 0.1864, 0.2107,
      0.2136, 0.2149, 0.2124, 0.1949, 0.1973, 0.2114, 0.2054, 0.1989,
      0.2086, 0.2138, 0.1941, 0.2022, 0.7354, 0.7073, 0.7115, 0.6972,
      0.7255, 0.7335, 0.7283, 0.737, 0.7147, 0.7148, 0.7138, 0.7171,
      0.7401, 0.7166, 0.7129, 0.7205, 0.7143, 0.7109, 0.7239, 0.7217,
      0.7329, 0.723, 0.7178, 0.7207, 0.7255, 0.7357, 0.7199, 0.7145,
      0.7159, 0.7305, 0.7338, 0.7087, 0.7156, 0.7134, 0.7308, 0.7145,
      0.7061, 0.7055, 0.7358, 0.7281, 0.7191, 0.7054, 0.7277, 0.7106,
      0.7141, 0.7104, 0.7252, 0.7197, 0.7226, 0.7293, 0.7119, 0.7274,
      0.7172, 0.7133, 0.7193, 0.7369, 0.7182, 0.7247, 0.7105, 0.7237,
      0.7019, 0.7192, 0.7101, 0.711, 0.707, 0.7333, 0.7159, 0.7097,
      0.7184, 0.7296, 0.7161, 0.7214, 0.732, 0.7136, 0.707, 0.7086,
      0.7191, 0.728, 0.7156, 0.7164, 0.7365, 0.7177, 0.7237, 0.7205,
      0.7167, 0.7313, 0.7121, 0.7098, 0.7088, 0.7108, 0.7246, 0.7227,
      0.7116, 0.7163, 0.7214, 0.7138, 0.7097, 0.7252, 0.7188
    ),
    .Dim = c(99L, 2L),
    .Dimnames = list(NULL, c("Bbgg", "Bwgg"))
    )
  )
})

test_that("eiread maggs works", {
  expect_equal(
    eiread(dbuf, "maggs"),
    c(0.2018, 0.7192, 0.0114, 0.009)
  )
})

test_that("eiread VCaggs works", {
  expect_equal(
    eiread(dbuf, "VCaggs"),
    structure(c(1e-04, -2e-04, -2e-04, 0),
      .Dim = c(2L, 2L)
    )
  )
})

# test_that("eiread eaggbias works", {
#   expect_equal(eiread(dbuf, "eaggbias"),
#                structure(c(1e-04, -2e-04, -2e-04, 0),
#                          .Dim = c(2L, 2L))
#   )
# })

test_that("eiread goodman works", {
  expect_equal(
    eiread(dbuf, "goodman"),
    structure(c(0.1956, 0.7228, 0.0275, 0.023, 7.0995, 31.3996, 0, 0),
      .Dim = c(2L, 4L),
      .Dimnames = list(
        c("BetaB", "BetaW"),
        c("Estimate", "Std. Error", "t value", "Pr(>|t|)")
      )
    )
  )
})
