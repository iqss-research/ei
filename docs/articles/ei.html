<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EI: A(n R) Program for Ecological Inference • ei</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="EI: A(n R) Program for Ecological Inference">
<meta property="og:description" content="ei">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ei</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ei.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ei_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>EI: A(n R) Program for Ecological Inference</h1>
                        <h4 class="author">Gary King and Margaret Roberts</h4>
            
      
      
      <div class="hidden name"><code>ei.Rmd</code></div>

    </div>

    
    
<div id="introduction-ecological-inference" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-ecological-inference" class="anchor"></a>Introduction: Ecological Inference</h1>
<p>This program provides methods of inferring individual behavior from aggregate data. It implements the statistical procedures, diagnostics, and graphics from the Gary King, <strong>A Solution to the Ecological Inference Problem: Reconstructing Individual Behavior from Aggregate Data</strong> (Princeton: Princeton University Press, 1997), <a href="http://j.mp/ecinfbook">http://j.mp/ecinfbook</a>; Ori Rosen, Wenxin Jiang, Gary King, and Martin A. Tanner (2001) ``Bayesian and Frequentist Inference for Ecological Inferece: The RxC Case.’’ (<em>Statistica Neerlandica</em>, Vol.55, nr.2, pp 134-156), <a href="http://j.mp/eiRxC">http://j.mp/eiRxC</a>; and from our own ongoing work. Except where indicated, all references to page, section, chapter, table, and figure numbers in this document refer to the the first reference.</p>
<p>Ecological inference is the process of using aggregate (i.e., ``ecological’’) data to infer discrete individual-level relationships of interest when individual-level data are not available. Ecological inferences are required in political science research when individual-level surveys are unavailable (e.g., local or comparative electoral politics), unreliable (racial politics), insufficient (political geography), or infeasible (political history). They are also required in public policy (e.g., for applying the Voting Rights Act) and other academic disciplines ranging from epidemiology and marketing to sociology and quantitative history. Most researchers using aggregate data have encountered some form of the ecological inference problem.</p>
<p>Because the ecological inference problem is caused by the lack of individual-level information, no method of ecological inference, including that estimated by this program, will always produce accurate results. However, potential difficulties are reduced by models that include more available information, diagnostics to evaluate when assumptions need to be modified, easy methods of modifying the assumptions, and uncertainty estimates for quantities of interest. We recommend reviewing Chapter 16 while using this program for actual research. Model dependence defines ecological inference when going anywhere beyond the bounds and tomography plots, and so we have added new graphical procedures for evaluating the degree of model dependence.</p>
<p><code>ei</code> is a unifed program that contains methods for both the 2x2 ecological inference case and the RxC case. We will begin by explaining how to use eiR in the 2x2 case, and then move on to RxC examples.</p>
</div>
<div id="overview-2x2-r-commands" class="section level1">
<h1 class="hasAnchor">
<a href="#overview-2x2-r-commands" class="anchor"></a>Overview: 2x2 R-commands</h1>
<p>In this section we describe the basic commands for 2x2 inference. For this purpose, and without loss of generality, we use the running example from the book portrayed in Table 2.3 (page 31). This example uses the proportion of the voting age population who are black (<span class="math inline">\(X_i\)</span>), the proportion turning out to vote (<span class="math inline">\(T_i\)</span>), and the number of voting age people (<span class="math inline">\({N_i}\)</span>) in each precinct (<span class="math inline">\(i=1,\ldots,p\)</span>) to infer the fraction of blacks who vote (<span class="math inline">\(\beta_i^b\)</span>) and the proportion of whites who vote (<span class="math inline">\(\beta_i^w\)</span>), also in each precinct. (For an extended example of <code>ei</code>, refer to the user’s guide below.) An example of a sequence of these commands are as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">~</span> <span class="va">x</span>
<span class="va">dbuf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ei.html">ei</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, total <span class="op">=</span> <span class="st">"n"</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dbuf</span><span class="op">)</span>
<span class="fu"><a href="../reference/eiread.html">eiread</a></span><span class="op">(</span><span class="va">dbuf</span>, <span class="st">"betab"</span>, <span class="st">"betaw"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dbuf</span>, <span class="st">"tomog"</span>, <span class="st">"betab"</span>, <span class="st">"betaw"</span>, <span class="st">"xtfit"</span><span class="op">)</span></code></pre></div>
<p>In most applications, <code>plot</code> and <code>eiread</code> would likely be run multiple times with different options chosen, and other commands would be included with these five to read in the data (<code>t</code>, <code>x</code>, and <code>n</code>).</p>
<div id="ei-to-run-the-main-procedure" class="section level3">
<h3 class="hasAnchor">
<a href="#ei-to-run-the-main-procedure" class="anchor"></a><code>ei</code>: To run the main procedure</h3>
<p>Use the format, <code>dbuf = ei(formula, total = "n", data = data)</code>, which takes three <span class="math inline">\(p\times 1\)</span> vectors as inputs: <code>t</code> (e.g. the fraction of the voting age population turning out to vote); <code>x (e.g. the   fraction of the voting age population who are black); and</code>n<code>(e.g. the total number of people in the voting age population). The output of this   procedure is the list</code>dbuf<code>(i.e. an output object of class   list called a "data buffer").  The data buffer includes the maximium likelihood estimates and simulated quantities of interest from the</code>ei<code>procedure. After running</code>ei<code>, it is a   good idea to save</code>dbuf<code>for further analysis.  The   output data buffer from</code>ei` includes a large variety of different results useful for understanding the results of the analysis. A minimal set of nonrepetitive information is stored in this list (or data buffer), and a large variety of other information can be easily computed from it. Fortunately, you do not need to know whether the information you request is stored or computed as both are treated the same.</p>
<p>To extract information from the data buffer, three procedures are available:</p>
</div>
<div id="summary-to-obtain-a-general-summary-of-district-level-information" class="section level3">
<h3 class="hasAnchor">
<a href="#summary-to-obtain-a-general-summary-of-district-level-information" class="anchor"></a><code>summary</code>: To obtain a general summary of district-level information</h3>
<p><code><a href="https://rdrr.io/r/base/summary.html">summary(dbuf)</a></code> will produce aggregate information about the <code>ei</code> results. <code>summary</code> will produce a summary of both the maximum likelihood estimates and simulated quantities of interest. It also includes information on the values specified for the prior.</p>
</div>
<div id="plot-to-graph-relevant-information" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-to-graph-relevant-information" class="anchor"></a><code>plot</code>: To graph relevant information</h3>
<p>For graphics, use <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(dbuf, "name")</a></code>;, where <code>dbuf</code> is the ei.object that is the output of <code>ei</code> or <code>ei.sim</code>, and name can be any number of a long list of ready-made graphs. For example, <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(dbuf,"tomog")</a></code> will plot a tomography graph, and <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(dbuf,"xt")</a></code> will display a scattercross graph. Any number of graphs can be selected in plot for output. For example, <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(dbuf,"tomog","xt")</a></code> will produce both a tomography graph and a scattercross graph.</p>
<p>Some of the plots can be produced after estimating the maximum likelihood estimates using <code>ei</code>, but before simulating quantities of interest. These initial plots can be useful in determining which priors to include, and the user can opt to choose not to simulate quantities of interest by selecting the option <code>simulate = FALSE</code>. However, for some plots, <code>plot</code> will need the simulated quantities of interest, and therefore can only be plotted when simulate is set to the default, <code>TRUE</code>.</p>
</div>
<div id="eiread-to-obtain-relevant-information-and-numerical-results" class="section level3">
<h3 class="hasAnchor">
<a href="#eiread-to-obtain-relevant-information-and-numerical-results" class="anchor"></a><code>eiread</code>: To obtain relevant information and numerical results</h3>
<p>For numerical information, use <code>v &lt;- eiread(dbuf, "name")</code>, where <code>v</code> is the item extracted, <code>dbuf</code> is the data buffer output from <code>ei</code>, and name can be any of a list of output possibilities. For example, <code><a href="../reference/eiread.html">eiread(dbuf, "betab")</a></code> will give a vector of point estimates of <span class="math inline">\(\beta_i^b\)</span>, <code><a href="../reference/eiread.html">eiread(dbuf, "ci80w")</a></code> will give 80% confidence intervals for <span class="math inline">\(\beta_i^w\)</span>. Any number of items can be selected for output. For example, <code><a href="../reference/eiread.html">eiread(dbuf, "betab", "ci80b")</a></code> will produce a list of the point estimates and 80% confidence intervals for $ _i^b$.</p>
</div>
</div>
<div id="users-guide-an-example" class="section level1">
<h1 class="hasAnchor">
<a href="#users-guide-an-example" class="anchor"></a>User’s Guide: An Example</h1>
<p>We now show how to use <code>ei</code> through a simple example. We use data on voter registration and racial background of people from 268 counties in four Southern U.S. States: Florida, Louisiana, and South Carolina. These are the same data used in Chapter 10. The data include the total voting age population in each county (<code>n</code>), the proportion of the population in each county who are black (<code>x</code>), and the proportion of the population in each county who are registered to vote (<code>t</code>). The proportion of whites registered can be computed by (<code>1-x</code>). You can load the data into R using the command</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://gking.harvard.edu/eiR">ei</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: eiPack</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">matproii</span><span class="op">)</span></code></pre></div>
<p>The statistical goal is to estimate the fraction of blacks registered (<span class="math inline">\(\beta_i^b\)</span>) and the fraction of whites registered (<span class="math inline">\(\beta_i^w\)</span>) in each county. These quantities of interest are generally unknown. However, <code>ei</code> also includes an option that allows the user to assess the reliability of the <code>ei</code> algorithm when the true quantities of interest are known. To illustrate the use of this `<code>truth" option, the data also include the true fractions of registered blacks (\verb#tb#) and the true fraction of registered whites (</code>tw`).</p>
<div id="the-basic-ei-algorithm" class="section level2">
<h2 class="hasAnchor">
<a href="#the-basic-ei-algorithm" class="anchor"></a>The Basic EI Algorithm</h2>
<p>To begin, we perform ecological inference by calling the function <code>ei</code>. <code>ei</code> first computes and maximizes a likelihood distribution based on the inputed data, then estimates the county-level quantities of interest based on the possible values, or ``bounds", for each county and the overall likelihood distribution.</p>
<p>To run this algorithm, at a minimum we need to have three vectors. Two vectors, <code>t</code> and <code>x</code>, contain the aggregate known information about the counties of interest. In this example, <code>t</code> is the proportion of voters registered in each county, and <code>x</code> is the proportion of blacks in each county. These two vectors contain aggregate information, since we are interested in the proportion of voters in each country who are black. The last vector we need is <code>n</code>, the number of people of interest in each county. In this example, <code>n</code> is the number of people of voting age.</p>
<p>We proceed by performing ecological inference without covariates on the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">~</span> <span class="va">x</span>
<span class="va">dbuf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ei.html">ei</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, total <span class="op">=</span> <span class="st">"n"</span>, data <span class="op">=</span> <span class="va">matproii</span><span class="op">)</span>
<span class="co">#&gt; [1] "Running 2x2 ei"</span>
<span class="co">#&gt; Maximizing likelihood</span>
<span class="co">#&gt; Importance Sampling..</span></code></pre></div>
<p>To include a covariate on <span class="math inline">\(\beta_i^b\)</span> simply specify a covariate vector for the option , or a string that refers to the name of the covariate in the dataset. Similarly, to include a covariate on <span class="math inline">\(\beta_i^w\)</span>, specify a covariate vector for for the option , or a string that refers to the name of the covariate in the dataset.</p>
<p>Next, we use and  to obtain general information about the estimation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dbuf</span><span class="op">)</span>
<span class="co">#&gt; $Erho</span>
<span class="co">#&gt; [1] 0.5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Esigma</span>
<span class="co">#&gt; [1] 0.5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Ebeta</span>
<span class="co">#&gt; [1] 0.5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $N</span>
<span class="co">#&gt; [1] 268</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Resamp</span>
<span class="co">#&gt; [1] 63</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`Maximum likelihood results in scale of estimation (and se's)`</span>
<span class="co">#&gt;       Bb0       Bw0       sigB       sigW       rho Zb Zw</span>
<span class="co">#&gt;  1.267096 1.9348588 -1.1150919 -1.3271231 1.6051353  0  0</span>
<span class="co">#&gt;  0.276096 0.2746691  0.2133685  0.1644862 0.3125443  0  0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`Untruncated psi's`</span>
<span class="co">#&gt;         BB       BW        SB        SW       RHO</span>
<span class="co">#&gt;  0.9705135 1.137265 0.3349463 0.2705725 0.9103862</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`Truncated psi's (ultimate scale)`</span>
<span class="co">#&gt;         BB        BW        SB        SW       RHO</span>
<span class="co">#&gt;  0.6163834 0.8271709 0.2008574 0.1422448 0.7473084</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`Aggregate Bounds`</span>
<span class="co">#&gt;           betab     betaw</span>
<span class="co">#&gt; lower 0.2125903 0.7025925</span>
<span class="co">#&gt; upper 0.9754242 0.9200036</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`Estimates of Aggregate Quantities of Interest`</span>
<span class="co">#&gt;         mean          sd</span>
<span class="co">#&gt; Bb 0.5664558 0.031182278</span>
<span class="co">#&gt; Bw 0.8191504 0.008887091</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $precision</span>
<span class="co">#&gt; [1] 4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "summary"</span></code></pre></div>
<p>The <code>summary</code> function provides basic information about the ecological inference estimation, the maximum likelihood estimates on three scales, and an overall summary of the quantities of interest. First, it reports the values of the priors used in ecological inference (<code>Erho, Esigma, Ebeta</code>). It also reports the number of counties in the dataset (<code>N</code>), as well as the number of importance sampling iterations required to produce estimates of the quantities of interest (<code>resamp</code>).</p>
<p><code>summary</code> also produces information both about the maximum likelihood estimates and the quantities of interest. First, it provides the maximum likelihood estimates in the scale of estimation. Next, it provides the values of the MLEs when they are transformed into an untruncated bivariate normal distribution. These estimates provide information about the location of the highest density of estimates for the proportion of blacks who are registered to vote and the proportion of whites who are registered to vote. Last, it provides the values of the MLEs on the ultimate truncated bivariate normal scale. These estimates are an unweighted average of the fraction of blacks and whites registered to vote over all the counties in the sample. In this example, the <code>ei</code> algorithm predicts that the unweighted average of the proportion of blacks registered to vote across counties is 0.57 and the unweighted average of the proportion of whites registered to vote is 0.82.</p>
<p>Finally, <code>summary</code> produces information on aggregrate quantities of interest. The aggregate bounds are the mean of the bounds on the proportions of black and white voters, weighted by the population in each county. The aggregate quantities of interest are the weighted mean of the proportion of registered blacks and the proportion of registered whites in each county. In this example the weighted average proportion of blacks who are registered is 0.57, and the weighted average proportion of whites who are registered is 0.82.</p>
</div>
<div id="extracting-quantities-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-quantities-of-interest" class="anchor"></a>Extracting Quantities of Interest</h2>
<p><code>eiread</code> extracts quantities of interest in a list format from the object <code>dbuf</code>. For example,</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bb.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eiread.html">eiread</a></span><span class="op">(</span><span class="va">dbuf</span>, <span class="st">"betab"</span>, <span class="st">"sbetab"</span><span class="op">)</span></code></pre></div>
<p>extracts the point estimates and estimated standard deviations for <span class="math inline">\(\beta_i^b\)</span>, the estimates of the proportion of registered blacks in each county. The user can then use <code>bb.out$betab</code> to obtain a vector of the point estimates for <span class="math inline">\(\beta_i^b\)</span>, and <code>bb.out$sbetab</code> to obtain a vector of the standard devations for <span class="math inline">\(\beta_i^b\)</span>.<br><code><a href="../reference/eiread.html">eiread()</a></code> takes any number of arguments to extract any number of quantities of interest from the data buffer. <code><a href="../reference/eiread.html">?eiread</a></code> can be used to find a list of quantities of interest that are available in <code>ei</code>. Among the most useful arguments are <code>"betab"</code> and <code>"betaw"</code>, which report the point estimates; <code>"sbetab"</code> and <code>"sbetaw"</code>, which report the standard deviations of the point estimates; and <code>"CI80b</code> and <code>"CI80w"</code>, which report the confidence intervals of the point estimates.</p>
</div>
<div id="plotting-in-ei" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-in-ei" class="anchor"></a>Plotting in EI</h2>
<p>Plotting <code>ei</code> output is extremely useful for understanding the results of the ecological inference algorithm and diagnosing problems with estimation. First, we graph a tomography plot of the data (Figure 1).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dbuf</span>, <span class="st">"tomog"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tomogplot.png" alt=""><p class="caption">Tomography Plot with ML Contours</p>
</div>
<div class="figure">
<img src="tomogplot2.png" alt=""><p class="caption">Tomography Plots: Point Estimates (left) and Confidence Intervals (right)</p>
</div>
<p>Each line on the map represents the possible values for <span class="math inline">\(\beta_i^b\)</span> and <span class="math inline">\(\beta_i^w\)</span> for one county. The contour lines identify the portion of the lines that have the highest probability of containing the true estimates of <span class="math inline">\(\beta_i^b\)</span> and <span class="math inline">\(\beta_i^w\)</span>. These contour lines provide information about the overall pattern of registration. Note that the area with highest probability is in the upper right-hand corner, where the proportion of whites registered is between <span class="math inline">\(0.75\)</span> and <span class="math inline">\(1\)</span> and the proportion of blacks registered is between <span class="math inline">\(0.5\)</span> and <span class="math inline">\(1\)</span>. Further, we see that the lines are clustered in the upper half of the figure, indicating that the possible values of <span class="math inline">\(\beta_i^w\)</span> will have a lower variance than the possible values of <span class="math inline">\(\beta_i^b\)</span>.  Figure 2 is a double plot of the point estimates and their confidence intervals. To compute this, we call plot to generate two graphs: a tomography plot with the point estimates generated from the algorithm, and a tomography plot with 80% confidence intervals on the point estimate.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dbuf</span>, <span class="st">"tomogE"</span>, <span class="st">"tomogCI"</span><span class="op">)</span></code></pre></div>
<p>This plot is useful to visualize the estimates and confidence intervals for each county. We can see that the point estimates and confidence intervals are clustered in the same area as the contours from the previous plot. Further, the point estimates and confidence intervals only fall on the lines that indicate the possible values of <span class="math inline">\(\beta_i^b\)</span> and <span class="math inline">\(\beta_i^w\)</span>.  Figure 3 shows plots that indicate the distribution of <span class="math inline">\(\beta_i^b\)</span> and <span class="math inline">\(\beta_i^w\)</span>. To produce these plots, run:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dbuf</span>, <span class="st">"betab"</span>, <span class="st">"betaw"</span><span class="op">)</span></code></pre></div>
<p>Density plots are useful to visualize the location and uncertainty of the point estimates. The green line represents the density of the simulated point estimates, and the black tick marks are a rug plot of the point estimates,s <span class="math inline">\(\beta_i^b\)</span> and <span class="math inline">\(\beta_i^w\)</span>. You can see that the variance of the point estimates from <span class="math inline">\(\beta_i^b\)</span> is much higher than the variance of point estimates from <span class="math inline">\(\beta_i^w\)</span>.<br>
 Figure 4 portrays the results of the <code>ei</code> algorithm by plotting the proportion of blacks in each country by the proportion of registered voters in each county. To produce this plot, use:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dbuf</span>, <span class="st">"xtfit"</span><span class="op">)</span></code></pre></div>
<p>The circles around each of the points in this plot are proportional to the population of each county. The graph represents the likelihood estimates by plotting the expected number of registered voters given the proportion of blacks in each county, represented by the yellow line. The red lines in the plot are the 80% confidence interval around the regression line. The higher uncertainty in the estimates of black registration can be seen by the absence of points on the right hand side of the graph and the larger confidence interval on the right hand side of the graph, where the proportion of blacks in the county is relatively large.</p>
<div class="figure">
<img src="betas.png" alt=""><p class="caption">Plots with Distribution of Point Estimates for <span class="math inline">\(\beta_i^b\)</span> (left) and <span class="math inline">\(\beta_i^w\)</span> (right), for all <span class="math inline">\(i\)</span></p>
</div>
<div class="figure">
<img src="xtfit.png" alt=""><p class="caption">X and T Scatterplot with E(T|X) and 80% CIs</p>
</div>
<div style="page-break-after: always;"></div>
<p>Finally, if we have data on the true proportions of registered blacks and registered whites in each county, as we do in this dataset, we can use plots in <code>ei</code> to assess how well the algorithm works on the given data. To do this, rerun the <code>ei</code> algorithm, adding the truth vectors,  and <code>tw</code> as the truth argument.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">matproii</span><span class="op">$</span><span class="va">tb</span>, <span class="va">matproii</span><span class="op">$</span><span class="va">tw</span><span class="op">)</span>
<span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">~</span> <span class="va">x</span>
<span class="va">dbuf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ei.html">ei</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, total <span class="op">=</span> <span class="st">"n"</span>, data <span class="op">=</span> <span class="va">matproii</span>, truth <span class="op">=</span> <span class="va">truth</span><span class="op">)</span>
<span class="co">#&gt; [1] "Running 2x2 ei"</span>
<span class="co">#&gt; Maximizing likelihood</span>
<span class="co">#&gt; Importance Sampling..</span></code></pre></div>
<p>Then use plot to compare the estimates of the <code>ei</code> algorithm to the true proportions of white and black registered voters in each county.</p>
<p>TODO: set eval = TRUE</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dbuf</span>, <span class="st">"truth"</span><span class="op">)</span></code></pre></div>
<p>The “truth” plot (Figure 5) has four components. The top two figures have the posterior densities of the aggregate quantities of interest <span class="math inline">\(B^b\)</span> and <span class="math inline">\(B^w\)</span>. These densities tell us in what range the algorithm predicts that the point estimates lie. For example, the density of <span class="math inline">\(B^b\)</span> is wider than the density of <span class="math inline">\(B^w\)</span>, indicating that our estimates of <span class="math inline">\(B^w\)</span> lie in a smaller range than than our estimates of <span class="math inline">\(B^b\)</span>. The true aggregate values, computed from the  data we inputed, are indicated by the vertical bars. The fact that the true <span class="math inline">\(B^b\)</span> and <span class="math inline">\(B^w\)</span> are within the densities we computed confirms that the model is did a good job at predicting the true proportions of registered white and black voters.</p>
<p>The bottom two figures in Figure 5 plot the estimated values of <span class="math inline">\(\beta_i^b\)</span> and <span class="math inline">\(\beta_i^w\)</span> against the true values. The size of each of the circles plotted is proportional to the number of blacks in the county in the first graph and the number of whites in each county in the second graph. If the estimated values were exactly equal to the true values, all of the points would be on the <span class="math inline">\(45^{\circ}\)</span> line. Because the points fall quite close to the <span class="math inline">\(45^{\circ}\)</span> and do not deviate from the line in a systematic way, we can see that the <code>ei</code> algorithm predicts the point estimates quite well.</p>
<p>Comparing Estimates to the Truth at the County Level</p>
</div>
</div>
<div id="overvieweirxc-r-commands" class="section level1">
<h1 class="hasAnchor">
<a href="#overvieweirxc-r-commands" class="anchor"></a>Overview:eiRxC R-commands</h1>
<p>Although the 2x2 case is useful in many circumstances, eiR also allows users to expand beyond the 2x2 case and implement RxC models. To do this, eiR contains the MCMC implementation of the multinomial-Dirichlet eiRxC model in Rosen, Jiang, King and Tanner (2001) “Bayesian and Frequentist Inference for Ecological Inferece: The RxC Case.” (<em>Statistica Neerlandica</em>, Vol. 55, nr.2, pp 134-156), and incorporates R code from <code>eiPack</code> (Olivia Lau, Ryan Moore and Mike Kellermann).</p>
<p>In this section we describe the basic commands needed for eiRxC. Imagine that instead of a 2x2 table where the user aims to infer the proportion of whites and non-whites who turned out to vote, for example, the user instead wants to infer the percent of turnout for white, black, and hispanic. This is a 2x3 table because the resulting estimates from this table will include two estimates (percent turnout and no turnout) for three categories of people (white, black and hispanic).</p>
<p>We use the data <code>RxCdata</code> as a running example. <code>RxCdata</code> has variables for each of the five marginal variables for the 2x3 table: <code>turnout</code> is the number of people in each precinct who turned out to vote, <code>noturnout</code> is the number of people in each precinct that did not turn out to vote, <code>white</code> is the number of people who are white in the precinct, <code>black</code> is the number of people who are black in the precinct, and <code>hisp</code> is the number of people who are hispanic in the precinct. Note that, different that the 2x2 case, these are the numbers of people rather than proportions. The user can include proportions if they want to, but then must include the argument <code>total</code> for the the total number of people in the precinct.</p>
<p>To begin, we load the RxC data from the <code>ei</code> library.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">RxCdata</span><span class="op">)</span></code></pre></div>
<p>The formula for the eiRxC case tells the program which variables go on each side of the table. In this example, we have turnout and no turnout on one side of the table, and white, black and hispanic on the other side. Therefore, our formula is:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">turnout</span>, <span class="va">noturnout</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">white</span>, <span class="va">black</span>, <span class="va">hisp</span><span class="op">)</span></code></pre></div>
<p>We can call this formula using ei:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dbuf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ei.html">ei</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">RxCdata</span><span class="op">)</span></code></pre></div>
<p>The MCMC output for the <span class="math inline">\(\beta\)</span>’s can be found in the data buffer .  is a matrix that contains the simulations for each of the <span class="math inline">\(\beta\)</span>’s for each precinct. Since there are 60 precincts in this dataset and 6 quantities of interest, the number of columns of  is <span class="math inline">\(60*6 = 360\)</span>. We can analyze the MCMC output by picking out which <span class="math inline">\(\beta\)</span> we are interested at any given time. For example, to look at the MCMC output for the estimated percent white turnout for the third precinct we can use the R code:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">dbuf</span><span class="op">$</span><span class="va">draws</span><span class="op">$</span><span class="va">Beta</span><span class="op">[</span>, <span class="st">"beta.white.turnout.3"</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></code></pre></div>
<p>We can also plot this MCMC output to assess convergence:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="MCMCplot.png" alt=""><p class="caption">MCMC Output for % White Turnout in Precinct 3</p>
</div>
<p>From this output we can get the empirical mean and standard deviation of each of our quantities of interest. The user can add in extra arguments to specify the number of simulations, burnin, or priors for this function. For more information on this, see the documentation for <code>eiPack</code> and the Rosen et al (2001) paper.</p>
</div>
<div id="eirxc-tomography-plots-assessing-model-dependence" class="section level1">
<h1 class="hasAnchor">
<a href="#eirxc-tomography-plots-assessing-model-dependence" class="anchor"></a>eiRxC Tomography Plots: Assessing Model Dependence</h1>
<p>While eiRxC model estimates are helpful, the uncertainty estimates they produce are — like all ecological inference point estimates — conditional on the model assumed. Yet, most of the actual scientific uncertainty in ei models does not stem from the sampling uncertainty given a statistical model, but rather the uncertainty associated with choosing a model — what is known as model dependence (King and Zeng 2006). A tomography plot that contains information about the possible values of the quantities of interest is therefore more useful than the model in understanding the true amount of information in the data from which the model is obtaining its estimates.</p>
<p>While this has not been available in the RxC case before, we have developed a method to creating and displaying tomography plots for 2x3 RxC problems and by extension examine model dependence in any RxC model.</p>
<p>In the 2x3 case, we can do this by using the function <code>tomogRxC</code>. Following the code above, using the <code>RxCdata</code>,</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">turnout</span>, <span class="va">noturnout</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">white</span>, <span class="va">black</span>, <span class="va">hisp</span><span class="op">)</span>
<span class="fu"><a href="../reference/tomogRxC.html">tomogRxC</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">RxCdata</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="whiteblackRxC.png" alt=""><p class="caption">2x3 Tomography Plot: % White Turnout and % Black Turnout</p>
</div>
<p>Each of the polygons on the plot below represent all the possibile values in a given precinct for percent white turnout and percent black turnout. The plot follows what we call the Law of Conservation of Ink, where tomography polygons with more information (smaller polygons) are colored brighter than those with less information (larger polygons). The colors on the plot are a heat map that are brighter when polygons overlap each other. The polygons in this particular district contain a lot of information about the percent white turnout, as the vast majority of the polygons only contain low values of percent white turnout, but they contain very little information about the percent black turnout, as most of the polygons seem to cover the entire range possible for percent black turnout.</p>
<p>The quantity of interest percent hispanic turnout is left out of this tomography plot, since we can only graph two quantities of interest simulataneously. However, if we reorganize the formula, putting white and hispanic first on the right hand side of the formula, we can create another tomography plot that expores the deterministic information for percent white turnout and percent hispanic turnout.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">turnout</span>, <span class="va">noturnout</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">white</span>, <span class="va">hisp</span>, <span class="va">black</span><span class="op">)</span>
<span class="fu"><a href="../reference/tomogRxC.html">tomogRxC</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">RxCdata</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="whitehispRxC.png" alt=""><p class="caption">2x3 Tomography Plot: % White Turnout and % Hispanic Turnout</p>
</div>
<p>With this new tomography plot (in Figure 8), we find very similar results to the previous one. While we have quite a bit of information about the percent white turnout, we have less information about percent hispanic turnout. This result derives from the fact that there are very few hispanics and blacks in this particular district.</p>
<p>Last, we can plot the remaining two quantities of interest – percent black turnout and percent hispanic turnout– against each other:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">turnout</span>, <span class="va">noturnout</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">hisp</span>, <span class="va">black</span>, <span class="va">white</span><span class="op">)</span>
<span class="fu"><a href="../reference/tomogRxC.html">tomogRxC</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">RxCdata</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="hispblackRxC.png" alt=""><p class="caption">2x3 Tomography Plot: % Hispanic Turnout and % Black Turnout</p>
</div>
<p>Here we see that even though the informative polygons indicate low values of percent hispanic and black turnout, we have the least information about the intersection of percent black and hispanic turnout. The polygons are spread all across the unit square space, indicating that the possible values for percent black and hispanic turnout spread over a large area. In the bottom right hand corner, and on the R console, the tomography plot reports how many of the tomography polygons have no information, or how many tomography polygons cover the entire unit square. Here we see that ther are 34 tomography polygons with no information, and since we onlyhave 60 precincts, this means that we have very little information for these quantities of interest. We might be more confident in the estimates for white turnout in this RxC analysis than for black and hispanic turnout.</p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Gary King, <em>A Solution to the Ecological Inference Problem: Reconstructing Individual Behaviour from Aggregate Data</em>, Princeton University Press (1997).</p>
<p>Gary King and Langche Zeng, “The Dangers of Extreme Counterfactuals.” <em>Political Analysis</em>, 14:2, pp 131-159, 2006.</p>
<p>Lau et al, “eiPack: Ecological Inference and Higher-Dimension Dtaa Management.” <a href="http://www.olivialau.org/software" class="uri">http://www.olivialau.org/software</a>.</p>
<p>Rosen et al, “Bayesian and Frequentist Inference for Ecological Inference: The RxC Case.” <em>Statistica Neerlandica</em>, 55:2, pp 134-156, 2001.</p>
<p>Useful documentation also avalaible at <a href="http://gking.harvard.Edu" class="uri">http://gking.harvard.Edu</a>.</p>
<p>For R language see <a href="http://www.r-project.org" class="uri">http://www.r-project.org</a>.</p>
<p>Venables, W.N.,and Ripley, B.D., <em>Statistics and Computing</em>, Springer (2002).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gary King, Molly Roberts.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
