<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2x2 Case • ei</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2x2 Case">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ei</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-s-guide" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User's Guide</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-s-guide">
<li><a class="dropdown-item" href="../articles/ei-introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/ei-2x2.html">2x2 case</a></li>
    <li><a class="dropdown-item" href="../articles/ei-RxC.html">RxC case</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/iqss-research/ei/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>2x2 Case</h1>
                        <h4 data-toc-skip class="author">Gary King and
Margaret Roberts</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iqss-research/ei/blob/master/vignettes/ei-2x2.Rmd" class="external-link"><code>vignettes/ei-2x2.Rmd</code></a></small>
      <div class="d-none name"><code>ei-2x2.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview-2x2-r-commands">Overview: 2x2 R-commands<a class="anchor" aria-label="anchor" href="#overview-2x2-r-commands"></a>
</h2>
<p>In this section we describe the basic commands for 2x2 inference. For
this purpose, and without loss of generality, we use the running example
from the book portrayed in Table 2.3 (page 31). This example uses the
proportion of the voting age population who are black
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>),
the proportion turning out to vote
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>i</mi></msub><annotation encoding="application/x-tex">T_i</annotation></semantics></math>),
and the number of voting age people
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>i</mi></msub><annotation encoding="application/x-tex">{N_i}</annotation></semantics></math>)
in each precinct
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">i=1,\ldots,p</annotation></semantics></math>)
to infer the fraction of blacks who vote
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>)
and the proportion of whites who vote
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>),
also in each precinct. (For an extended example of <code>ei</code>,
refer to the user’s guide below.) An example of a sequence of these
commands are as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://gking.harvard.edu/eiR" class="external-link">ei</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">matproii</span><span class="op">)</span></span>
<span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">~</span> <span class="va">x</span></span>
<span><span class="va">dbuf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ei.html">ei</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, total <span class="op">=</span> <span class="st">"n"</span>, data <span class="op">=</span> <span class="va">matproii</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dbuf</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_tomog.html">plot_tomog</a></span><span class="op">(</span><span class="va">dbuf</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_xt.html">plot_xt</a></span><span class="op">(</span><span class="va">dbuf</span><span class="op">)</span></span></code></pre></div>
<p>In most applications, <code>plot</code> and <code>eiread</code> would
likely be run multiple times with different options chosen, and other
commands would be included with these five to read in the data
(<code>t</code>, <code>x</code>, and <code>n</code>).</p>
<div class="section level4">
<h4 id="ei-to-run-the-main-procedure">
<code>ei</code>: To run the main procedure<a class="anchor" aria-label="anchor" href="#ei-to-run-the-main-procedure"></a>
</h4>
<p>Use the format,
<code>dbuf = ei(formula, total = "n", data = data)</code>, which takes
three
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p\times 1</annotation></semantics></math>
vectors as inputs: <code>t</code> (e.g. the fraction of the voting age
population turning out to vote); <code>x</code> (e.g. the fraction of
the voting age population who are black); and <code>n</code> (e.g. the
total number of people in the voting age population). The output of this
procedure is the list <code>dbuf</code> (i.e. an output object of class
list called a “data buffer”). The data buffer includes the maximium
likelihood estimates and simulated quantities of interest from the
<code>ei</code> procedure. After running <code>ei</code>, it is a good
idea to save <code>dbuf</code> for further analysis. The output data
buffer from <code>ei</code> includes a large variety of different
results useful for understanding the results of the analysis. A minimal
set of nonrepetitive information is stored in this list (or data
buffer), and a large variety of other information can be easily computed
from it. Fortunately, you do not need to know whether the information
you request is stored or computed as both are treated the same.</p>
<p>To extract information from the data buffer, three procedures are
available:</p>
</div>
<div class="section level4">
<h4 id="summary-to-obtain-a-general-summary-of-district-level-information">
<code>summary</code>: To obtain a general summary of district-level
information<a class="anchor" aria-label="anchor" href="#summary-to-obtain-a-general-summary-of-district-level-information"></a>
</h4>
<p><code>summary(dbuf)</code> will produce aggregate information about
the <code>ei</code> results. <code>summary</code> will produce a summary
of both the maximum likelihood estimates and simulated quantities of
interest. It also includes information on the values specified for the
prior.</p>
</div>
<div class="section level4">
<h4 id="plot-to-graph-relevant-information">
<code>plot</code>: To graph relevant information<a class="anchor" aria-label="anchor" href="#plot-to-graph-relevant-information"></a>
</h4>
<p>For graphics, use <code>plot_**(dbuf)</code>;, where
<code>dbuf</code> is the ei.object that is the output of <code>ei</code>
or <code>ei.sim</code>, and <code>**</code> completes a function for
ready-made graphs. For example, <code>plot_tomog(dbuf)</code> will plot
a tomography graph, and <code>plot_xt(dbuf)</code> will display a
scattercross graph. Any number of graphs can be selected in plot for
output.</p>
<p>Some of the plots can be produced after estimating the maximum
likelihood estimates using <code>ei</code>, but before simulating
quantities of interest. These initial plots can be useful in determining
which priors to include, and the user can opt to choose not to simulate
quantities of interest by selecting the option
<code>simulate = FALSE</code>. However, for some plots,
<code>plot</code> will need the simulated quantities of interest, and
therefore can only be plotted when simulate is set to the default,
<code>TRUE</code>.</p>
</div>
<div class="section level4">
<h4 id="eiread-to-obtain-relevant-information-and-numerical-results">
<code>eiread</code>: To obtain relevant information and numerical
results<a class="anchor" aria-label="anchor" href="#eiread-to-obtain-relevant-information-and-numerical-results"></a>
</h4>
<p>For numerical information, use
<code>v &lt;- eiread(dbuf, "name")</code>, where <code>v</code> is the
item extracted, <code>dbuf</code> is the data buffer output from
<code>ei</code>, and name can be any of a list of output possibilities.
For example, <code>eiread(dbuf, "betab")</code> will give a vector of
point estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>,
<code>eiread(dbuf, "ci80w")</code> will give 80% confidence intervals
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>.
Any number of items can be selected for output. For example,
<code>eiread(dbuf, "betab", "ci80b")</code> will produce a list of the
point estimates and 80% confidence intervals for $ _i^b$.</p>
</div>
</div>
<div class="section level2">
<h2 id="users-guide-an-example">User’s Guide: An Example<a class="anchor" aria-label="anchor" href="#users-guide-an-example"></a>
</h2>
<p>We now show how to use <code>ei</code> through a simple example. We
use data on voter registration and racial background of people from 268
counties in four Southern U.S. States: Florida, Louisiana, and South
Carolina. These are the same data used in Chapter 10. The data include
the total voting age population in each county (<code>n</code>), the
proportion of the population in each county who are black
(<code>x</code>), and the proportion of the population in each county
who are registered to vote (<code>t</code>). The proportion of whites
registered can be computed by (<code>1-x</code>). You can load the data
into R using the command</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://gking.harvard.edu/eiR" class="external-link">ei</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: eiPack</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ei'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">matproii</span><span class="op">)</span></span></code></pre></div>
<p>The statistical goal is to estimate the fraction of blacks registered
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>)
and the fraction of whites registered
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>)
in each county. These quantities of interest are generally unknown.
However, <code>ei</code> also includes an option that allows the user to
assess the reliability of the <code>ei</code> algorithm when the true
quantities of interest are known. To illustrate the use of this “truth”
option, the data also include the true fractions of registered blacks ()
and the true fraction of registered whites (<code>tw</code>).</p>
<div class="section level3">
<h3 id="the-basic-ei-algorithm">The Basic EI Algorithm<a class="anchor" aria-label="anchor" href="#the-basic-ei-algorithm"></a>
</h3>
<p>To begin, we perform ecological inference by calling the function
<code>ei</code>. <code>ei</code> first computes and maximizes a
likelihood distribution based on the inputed data, then estimates the
county-level quantities of interest based on the possible values, or
``bounds”, for each county and the overall likelihood distribution.</p>
<p>To run this algorithm, at a minimum we need to have three vectors.
Two vectors, <code>t</code> and <code>x</code>, contain the aggregate
known information about the counties of interest. In this example,
<code>t</code> is the proportion of voters registered in each county,
and <code>x</code> is the proportion of blacks in each county. These two
vectors contain aggregate information, since we are interested in the
proportion of voters in each country who are black. The last vector we
need is <code>n</code>, the number of people of interest in each county.
In this example, <code>n</code> is the number of people of voting
age.</p>
<p>We proceed by performing ecological inference without covariates on
the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">~</span> <span class="va">x</span></span>
<span><span class="va">dbuf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ei.html">ei</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, total <span class="op">=</span> <span class="st">"n"</span>, data <span class="op">=</span> <span class="va">matproii</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Running 2x2 ei</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Maximizing likelihood for `erho` = 0.5.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Running 2x2 ei<span style="color: #00BB00;">✔</span> Running 2x2 ei <span style="color: #B2B2B2;">[3ms]</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ⠙ Beginning importance sampling.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Beginning importance sampling. <span style="color: #B2B2B2;">[165ms]</span></span></span></code></pre></div>
<p>To include a covariate on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>
simply specify a covariate vector for the option , or a string that
refers to the name of the covariate in the dataset. Similarly, to
include a covariate on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>,
specify a covariate vector for for the option , or a string that refers
to the name of the covariate in the dataset.</p>
<p>Next, we use <code>summary(dbuf)</code> to obtain general information
about the estimation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dbuf</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Summary</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Erho</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Esigma</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Ebeta</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 0.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">N</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 268</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Resamp</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 19</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Maximum likelihood results in scale of estimation (and se's)</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        Bb0       Bw0       sigB       sigW       rho Zb0 Zw0</span></span>
<span><span class="co">#&gt;  1.2671900 1.9349556 -1.1149542 -1.3270775 1.6053564   0   0</span></span>
<span><span class="co">#&gt;  0.2846636 0.2826169  0.2140042  0.1646036 0.3145764   0   0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Untruncated psi's</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         BB       BW        SB        SW       RHO</span></span>
<span><span class="co">#&gt;  0.9905045 1.152859 0.3368288 0.2760415 0.9179783</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Truncated psi's (ultimate scale)</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         BB        BW       SB        SW       RHO</span></span>
<span><span class="co">#&gt;  0.6199244 0.8259608 0.198239 0.1423288 0.7695587</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Aggregate Bounds</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           betab     betaw</span></span>
<span><span class="co">#&gt; lower 0.2125903 0.7025925</span></span>
<span><span class="co">#&gt; upper 0.9754242 0.9200036</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Estimates of Aggregate Quantities of Interest</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         mean          sd</span></span>
<span><span class="co">#&gt; Bb 0.5711949 0.024469142</span></span>
<span><span class="co">#&gt; Bw 0.8177997 0.006973817</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Precision</span> ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 4</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>The <code>summary</code> function provides basic information about
the ecological inference estimation, the maximum likelihood estimates on
three scales, and an overall summary of the quantities of interest.
First, it reports the values of the priors used in ecological inference
(<code>Erho, Esigma, Ebeta</code>). It also reports the number of
counties in the dataset (<code>N</code>), as well as the number of
importance sampling iterations required to produce estimates of the
quantities of interest (<code>resamp</code>).</p>
<p><code>summary</code> also produces information both about the maximum
likelihood estimates and the quantities of interest. First, it provides
the maximum likelihood estimates in the scale of estimation. Next, it
provides the values of the MLEs when they are transformed into an
untruncated bivariate normal distribution. These estimates provide
information about the location of the highest density of estimates for
the proportion of blacks who are registered to vote and the proportion
of whites who are registered to vote. Last, it provides the values of
the MLEs on the ultimate truncated bivariate normal scale. These
estimates are an unweighted average of the fraction of blacks and whites
registered to vote over all the counties in the sample. In this example,
the <code>ei</code> algorithm predicts that the unweighted average of
the proportion of blacks registered to vote across counties is 0.57 and
the unweighted average of the proportion of whites registered to vote is
0.82.</p>
<p>Finally, <code>summary</code> produces information on aggregrate
quantities of interest. The aggregate bounds are the mean of the bounds
on the proportions of black and white voters, weighted by the population
in each county. The aggregate quantities of interest are the weighted
mean of the proportion of registered blacks and the proportion of
registered whites in each county. In this example the weighted average
proportion of blacks who are registered is 0.57, and the weighted
average proportion of whites who are registered is 0.82.</p>
</div>
<div class="section level3">
<h3 id="extracting-quantities-of-interest">Extracting Quantities of Interest<a class="anchor" aria-label="anchor" href="#extracting-quantities-of-interest"></a>
</h3>
<p><code>eiread</code> extracts quantities of interest in a list format
from the object <code>dbuf</code>. For example,</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eiread.html">eiread</a></span><span class="op">(</span><span class="va">dbuf</span>, <span class="st">"betab"</span>, <span class="st">"sbetab"</span><span class="op">)</span></span></code></pre></div>
<p>extracts the point estimates and estimated standard deviations for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>,
the estimates of the proportion of registered blacks in each county. The
user can then use <code>bb.out$betab</code> to obtain a vector of the
point estimates for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>,
and <code>bb.out$sbetab</code> to obtain a vector of the standard
devations for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>.
<code><a href="../reference/eiread.html">eiread()</a></code> takes any number of arguments to extract any
number of quantities of interest from the data buffer.
<code><a href="../reference/eiread.html">?eiread</a></code> can be used to find a list of quantities of
interest that are available in <code>ei</code>. Among the most useful
arguments are <code>"betab"</code> and <code>"betaw"</code>, which
report the point estimates; <code>"sbetab"</code> and
<code>"sbetaw"</code>, which report the standard deviations of the point
estimates; and <code>"CI80b</code> and <code>"CI80w"</code>, which
report the confidence intervals of the point estimates.</p>
</div>
<div class="section level3">
<h3 id="plotting-in-ei">Plotting in EI<a class="anchor" aria-label="anchor" href="#plotting-in-ei"></a>
</h3>
<p>Plotting <code>ei</code> output is extremely useful for understanding
the results of the ecological inference algorithm and diagnosing
problems with estimation. First, we graph a tomography plot of the data
(Figure 1).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_tomog.html">plot_tomog</a></span><span class="op">(</span><span class="va">dbuf</span><span class="op">)</span></span></code></pre></div>
<p><img src="ei-2x2_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="700"></p>
<p>Tomography Plot with ML Contours:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_tomog.html">plot_tomog</a></span><span class="op">(</span><span class="va">dbuf</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>contour_ML <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ei-2x2_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" alt="" width="700"></p>
<p>Tomography Plots with Point Estimates</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_tomog.html">plot_tomog</a></span><span class="op">(</span><span class="va">dbuf</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ei-2x2_files/figure-html/unnamed-chunk-9-1.png" class="r-plt" alt="" width="700"></p>
<p>Tomography Plots with Confidence Intervals</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_tomog.html">plot_tomog</a></span><span class="op">(</span><span class="va">dbuf</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>CI <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ei-2x2_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="" width="700"></p>
<p>Each line on the map represents the possible values for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>
for one county. The contour lines identify the portion of the lines that
have the highest probability of containing the true estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>.
These contour lines provide information about the overall pattern of
registration. Note that the area with highest probability is in the
upper right-hand corner, where the proportion of whites registered is
between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.75</mn><annotation encoding="application/x-tex">0.75</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
and the proportion of blacks registered is between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>.
Further, we see that the lines are clustered in the upper half of the
figure, indicating that the possible values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>
will have a lower variance than the possible values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>.</p>
<p>Figure 2 is a double plot of the point estimates and their confidence
intervals. To compute this, we call plot to generate two graphs: a
tomography plot with the point estimates generated from the algorithm,
and a tomography plot with 80% confidence intervals on the point
estimate.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_tomog.html">plot_tomog</a></span><span class="op">(</span><span class="va">dbuf</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>points <span class="op">=</span> <span class="cn">TRUE</span>, CI <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ei-2x2_files/figure-html/unnamed-chunk-11-1.png" class="r-plt" alt="" width="700"></p>
<p>This plot is useful to visualize the estimates and confidence
intervals for each county. We can see that the point estimates and
confidence intervals are clustered in the same area as the contours from
the previous plot. Further, the point estimates and confidence intervals
only fall on the lines that indicate the possible values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>.</p>
<p>Figure 3 shows plots that indicate the distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>.
To produce these plots, run:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_density.html">plot_density</a></span><span class="op">(</span><span class="va">dbuf</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameter <span class="op">=</span> <span class="st">"betab"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ei-2x2_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_density.html">plot_density</a></span><span class="op">(</span><span class="va">dbuf</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameter <span class="op">=</span> <span class="st">"betaw"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ei-2x2_files/figure-html/unnamed-chunk-12-2.png" class="r-plt" alt="" width="700"></p>
<p>Density plots are useful to visualize the location and uncertainty of
the point estimates. The green line represents the density of the
simulated point estimates, and the black tick marks are a rug plot of
the point estimates,s
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>.
You can see that the variance of the point estimates from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>
is much higher than the variance of point estimates from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>.</p>
<p>Figure 4 portrays the results of the <code>ei</code> algorithm by
plotting the proportion of blacks in each country by the proportion of
registered voters in each county. To produce this plot, use:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_xt.html">plot_xt</a></span><span class="op">(</span><span class="va">dbuf</span><span class="op">)</span></span></code></pre></div>
<p><img src="ei-2x2_files/figure-html/unnamed-chunk-13-1.png" class="r-plt" alt="" width="700"></p>
<p>The circles around each of the points in this plot are proportional
to the population of each county. The graph represents the likelihood
estimates by plotting the expected number of registered voters given the
proportion of blacks in each county, represented by the yellow line. The
red lines in the plot are the 80% confidence interval around the
regression line. The higher uncertainty in the estimates of black
registration can be seen by the absence of points on the right hand side
of the graph and the larger confidence interval on the right hand side
of the graph, where the proportion of blacks in the county is relatively
large.</p>
<div style="page-break-after: always;"></div>
<p>Finally, if we have data on the true proportions of registered blacks
and registered whites in each county, as we do in this dataset, we can
use plots in <code>ei</code> to assess how well the algorithm works on
the given data. To do this, rerun the <code>ei</code> algorithm, adding
the truth vectors, and <code>tw</code> as the truth argument.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">matproii</span><span class="op">$</span><span class="va">tb</span>, <span class="va">matproii</span><span class="op">$</span><span class="va">tw</span><span class="op">)</span></span>
<span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">~</span> <span class="va">x</span></span>
<span><span class="va">dbuf_truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ei.html">ei</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, total <span class="op">=</span> <span class="st">"n"</span>, data <span class="op">=</span> <span class="va">matproii</span>, truth <span class="op">=</span> <span class="va">truth</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Running 2x2 ei</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Maximizing likelihood for `erho` = 0.5.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Running 2x2 ei<span style="color: #00BB00;">✔</span> Running 2x2 ei <span style="color: #B2B2B2;">[1ms]</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ⠙ Beginning importance sampling.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Beginning importance sampling. <span style="color: #B2B2B2;">[191ms]</span></span></span></code></pre></div>
<p>Then use plot to compare the estimates of the <code>ei</code>
algorithm to the true proportions of white and black registered voters
in each county.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Comparing Estimates to the Truth at the County Level</span></span>
<span><span class="fu"><a href="../reference/plot_truth.html">plot_truth</a></span><span class="op">(</span><span class="va">dbuf_truth</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ei</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue at <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/iqss-research/ei/issues&gt;</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once per session.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="ei-2x2_files/figure-html/unnamed-chunk-15-1.png" class="r-plt" alt="" width="700"></p>
<p>The “truth” plot (Figure 5) has four components. The top two figures
have the posterior densities of the aggregate quantities of interest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>B</mi><mi>b</mi></msup><annotation encoding="application/x-tex">B^b</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>B</mi><mi>w</mi></msup><annotation encoding="application/x-tex">B^w</annotation></semantics></math>.
These densities tell us in what range the algorithm predicts that the
point estimates lie. For example, the density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>B</mi><mi>b</mi></msup><annotation encoding="application/x-tex">B^b</annotation></semantics></math>
is wider than the density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>B</mi><mi>w</mi></msup><annotation encoding="application/x-tex">B^w</annotation></semantics></math>,
indicating that our estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>B</mi><mi>w</mi></msup><annotation encoding="application/x-tex">B^w</annotation></semantics></math>
lie in a smaller range than than our estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>B</mi><mi>b</mi></msup><annotation encoding="application/x-tex">B^b</annotation></semantics></math>.
The true aggregate values, computed from the data we inputed, are
indicated by the vertical bars. The fact that the true
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>B</mi><mi>b</mi></msup><annotation encoding="application/x-tex">B^b</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>B</mi><mi>w</mi></msup><annotation encoding="application/x-tex">B^w</annotation></semantics></math>
are within the densities we computed confirms that the model is did a
good job at predicting the true proportions of registered white and
black voters.</p>
<p>The bottom two figures in Figure 5 plot the estimated values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>b</mi></msubsup><annotation encoding="application/x-tex">\beta_i^b</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>β</mi><mi>i</mi><mi>w</mi></msubsup><annotation encoding="application/x-tex">\beta_i^w</annotation></semantics></math>
against the true values. The size of each of the circles plotted is
proportional to the number of blacks in the county in the first graph
and the number of whites in each county in the second graph. If the
estimated values were exactly equal to the true values, all of the
points would be on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>45</mn><mo>∘</mo></msup><annotation encoding="application/x-tex">45^{\circ}</annotation></semantics></math>
line. Because the points fall quite close to the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>45</mn><mo>∘</mo></msup><annotation encoding="application/x-tex">45^{\circ}</annotation></semantics></math>
and do not deviate from the line in a systematic way, we can see that
the <code>ei</code> algorithm predicts the point estimates quite
well.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Gary King, <em>A Solution to the Ecological Inference Problem:
Reconstructing Individual Behaviour from Aggregate Data</em>, Princeton
University Press (1997).</p>
<p>Gary King and Langche Zeng, “The Dangers of Extreme Counterfactuals.”
<em>Political Analysis</em>, 14:2, pp 131-159, 2006.</p>
<p>Lau et al, “eiPack: Ecological Inference and Higher-Dimension Dtaa
Management.” <a href="http://www.olivialau.org/software" class="external-link uri">http://www.olivialau.org/software</a>.</p>
<p>Rosen et al, “Bayesian and Frequentist Inference for Ecological
Inference: The RxC Case.” <em>Statistica Neerlandica</em>, 55:2, pp
134-156, 2001.</p>
<p>Useful documentation also avalaible at <a href="http://gking.harvard.Edu" class="external-link uri">http://gking.harvard.Edu</a>.</p>
<p>For R language see <a href="http://www.r-project.org" class="external-link uri">http://www.r-project.org</a>.</p>
<p>Venables, W.N.,and Ripley, B.D., <em>Statistics and Computing</em>,
Springer (2002).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://gking.harvard.edu/" class="external-link">Gary King</a>, <a href="http://www.margaretroberts.net/" class="external-link">Molly Roberts</a>, <a href="https://christophertkenny.com/" class="external-link">Christopher T. Kenny</a>, <a href="https://shusei-e.github.io" class="external-link">Shusei Eshima</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
