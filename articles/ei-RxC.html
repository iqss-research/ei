<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ei">
<title>RxC Case • ei</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="RxC Case">
<meta property="og:description" content="ei">
<meta property="og:image" content="https://iqss-research.github.io/ei/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ei</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-user-s-guide">User's Guide</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-user-s-guide">
    <a class="dropdown-item" href="../articles/ei-introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/ei-2x2.html">2x2 case</a>
    <a class="dropdown-item" href="../articles/ei-RxC.html">RxC case</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/iqss-research/ei/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="ei-RxC_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>RxC Case</h1>
                        <h4 data-toc-skip class="author">Gary King and Margaret Roberts</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iqss-research/ei/blob/HEAD/vignettes/ei-RxC.Rmd" class="external-link"><code>vignettes/ei-RxC.Rmd</code></a></small>
      <div class="d-none name"><code>ei-RxC.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overvieweirxc-r-commands">Overview:eiRxC R-commands<a class="anchor" aria-label="anchor" href="#overvieweirxc-r-commands"></a>
</h2>
<p>Although the 2x2 case is useful in many circumstances, eiR also allows users to expand beyond the 2x2 case and implement RxC models. To do this, eiR contains the MCMC implementation of the multinomial-Dirichlet eiRxC model in Rosen, Jiang, King and Tanner (2001) “Bayesian and Frequentist Inference for Ecological Inferece: The RxC Case.” (<em>Statistica Neerlandica</em>, Vol. 55, nr.2, pp 134-156), and incorporates R code from <code>eiPack</code> (Olivia Lau, Ryan Moore and Mike Kellermann).</p>
<p>In this section we describe the basic commands needed for eiRxC. Imagine that instead of a 2x2 table where the user aims to infer the proportion of whites and non-whites who turned out to vote, for example, the user instead wants to infer the percent of turnout for white, black, and hispanic. This is a 2x3 table because the resulting estimates from this table will include two estimates (percent turnout and no turnout) for three categories of people (white, black and hispanic).</p>
<p>We use the data <code>RxCdata</code> as a running example. <code>RxCdata</code> has variables for each of the five marginal variables for the 2x3 table: <code>turnout</code> is the number of people in each precinct who turned out to vote, <code>noturnout</code> is the number of people in each precinct that did not turn out to vote, <code>white</code> is the number of people who are white in the precinct, <code>black</code> is the number of people who are black in the precinct, and <code>hisp</code> is the number of people who are hispanic in the precinct. Note that, different that the 2x2 case, these are the numbers of people rather than proportions. The user can include proportions if they want to, but then must include the argument <code>total</code> for the the total number of people in the precinct.</p>
<p>To begin, we load the RxC data from the <code>ei</code> library.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://gking.harvard.edu/eiR" class="external-link">ei</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: eiPack</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ei'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">RxCdata</span><span class="op">)</span></span></code></pre></div>
<p>The formula for the eiRxC case tells the program which variables go on each side of the table. In this example, we have turnout and no turnout on one side of the table, and white, black and hispanic on the other side. Therefore, our formula is:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">turnout</span>, <span class="va">noturnout</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">white</span>, <span class="va">black</span>, <span class="va">hisp</span><span class="op">)</span></span></code></pre></div>
<p>We can call this formula using ei:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dbuf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ei.html">ei</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">RxCdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Running eiRxC</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Running eiRxC <span style="color: #B2B2B2;">[119ms]</span></span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>The MCMC output for the <span class="math inline">\(\beta\)</span>’s can be found in the data buffer .  is a matrix that contains the simulations for each of the <span class="math inline">\(\beta\)</span>’s for each precinct. Since there are 60 precincts in this dataset and 6 quantities of interest, the number of columns of  is <span class="math inline">\(60*6 = 360\)</span>. We can analyze the MCMC output by picking out which <span class="math inline">\(\beta\)</span> we are interested at any given time. For example, to look at the MCMC output for the estimated percent white turnout for the third precinct we can use the R code:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">dbuf</span><span class="op">$</span><span class="va">draws</span><span class="op">$</span><span class="va">Beta</span><span class="op">[</span>, <span class="st">"beta.white.turnout.3"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iterations = 1:1000</span></span>
<span><span class="co">#&gt; Thinning interval = 1 </span></span>
<span><span class="co">#&gt; Number of chains = 1 </span></span>
<span><span class="co">#&gt; Sample size per chain = 1000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span></span>
<span><span class="co">#&gt;    plus standard error of the mean:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Mean             SD       Naive SE Time-series SE </span></span>
<span><span class="co">#&gt;       0.425644       0.035129       0.001111       0.004026 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2. Quantiles for each variable:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   2.5%    25%    50%    75%  97.5% </span></span>
<span><span class="co">#&gt; 0.3567 0.3988 0.4268 0.4535 0.4916</span></span></code></pre></div>
<p>We can also plot this MCMC output to assess convergence:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<p><img src="ei-RxC_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>From this output we can get the empirical mean and standard deviation of each of our quantities of interest. The user can add in extra arguments to specify the number of simulations, burnin, or priors for this function. For more information on this, see the documentation for <code>eiPack</code> and the Rosen et al (2001) paper.</p>
</div>
<div class="section level2">
<h2 id="eirxc-tomography-plots-assessing-model-dependence">eiRxC Tomography Plots: Assessing Model Dependence<a class="anchor" aria-label="anchor" href="#eirxc-tomography-plots-assessing-model-dependence"></a>
</h2>
<p>While eiRxC model estimates are helpful, the uncertainty estimates they produce are — like all ecological inference point estimates — conditional on the model assumed. Yet, most of the actual scientific uncertainty in ei models does not stem from the sampling uncertainty given a statistical model, but rather the uncertainty associated with choosing a model — what is known as model dependence (King and Zeng 2006). A tomography plot that contains information about the possible values of the quantities of interest is therefore more useful than the model in understanding the true amount of information in the data from which the model is obtaining its estimates.</p>
<p>While this has not been available in the RxC case before, we have developed a method to creating and displaying tomography plots for 2x3 RxC problems and by extension examine model dependence in any RxC model.</p>
<p>In the 2x3 case, we can do this by using the function <code>plot_tomogRxC</code>. Following the code above, using the <code>RxCdata</code>,</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">turnout</span>, <span class="va">noturnout</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">white</span>, <span class="va">black</span>, <span class="va">hisp</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_tomogRxC.html">plot_tomogRxC</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">RxCdata</span><span class="op">)</span></span></code></pre></div>
<p><img src="ei-RxC_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Each of the polygons on the plot below represent all the possibile values in a given precinct for percent white turnout and percent black turnout. The plot follows what we call the Law of Conservation of Ink, where tomography polygons with more information (smaller polygons) are colored brighter than those with less information (larger polygons). The colors on the plot are a heat map that are brighter when polygons overlap each other. The polygons in this particular district contain a lot of information about the percent white turnout, as the vast majority of the polygons only contain low values of percent white turnout, but they contain very little information about the percent black turnout, as most of the polygons seem to cover the entire range possible for percent black turnout.</p>
<p>The quantity of interest percent hispanic turnout is left out of this tomography plot, since we can only graph two quantities of interest simulataneously. However, if we reorganize the formula, putting white and hispanic first on the right hand side of the formula, we can create another tomography plot that expores the deterministic information for percent white turnout and percent hispanic turnout.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">turnout</span>, <span class="va">noturnout</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">white</span>, <span class="va">hisp</span>, <span class="va">black</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_tomogRxC.html">plot_tomogRxC</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">RxCdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; There are 1 tomography polygons with no information</span></span></code></pre></div>
<p><img src="ei-RxC_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>With this new tomography plot (in Figure 8), we find very similar results to the previous one. While we have quite a bit of information about the percent white turnout, we have less information about percent hispanic turnout. This result derives from the fact that there are very few hispanics and blacks in this particular district.</p>
<p>Last, we can plot the remaining two quantities of interest – percent black turnout and percent hispanic turnout– against each other:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">turnout</span>, <span class="va">noturnout</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">hisp</span>, <span class="va">black</span>, <span class="va">white</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_tomogRxC.html">plot_tomogRxC</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">RxCdata</span><span class="op">)</span></span>
<span><span class="co">#&gt; There are 34 tomography polygons with no information</span></span></code></pre></div>
<p><img src="ei-RxC_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Here we see that even though the informative polygons indicate low values of percent hispanic and black turnout, we have the least information about the intersection of percent black and hispanic turnout. The polygons are spread all across the unit square space, indicating that the possible values for percent black and hispanic turnout spread over a large area. In the bottom right hand corner, and on the R console, the tomography plot reports how many of the tomography polygons have no information, or how many tomography polygons cover the entire unit square. Here we see that ther are 34 tomography polygons with no information, and since we onlyhave 60 precincts, this means that we have very little information for these quantities of interest. We might be more confident in the estimates for white turnout in this RxC analysis than for black and hispanic turnout.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Gary King, <em>A Solution to the Ecological Inference Problem: Reconstructing Individual Behaviour from Aggregate Data</em>, Princeton University Press (1997).</p>
<p>Gary King and Langche Zeng, “The Dangers of Extreme Counterfactuals.” <em>Political Analysis</em>, 14:2, pp 131-159, 2006.</p>
<p>Lau et al, “eiPack: Ecological Inference and Higher-Dimension Dtaa Management.” <a href="http://www.olivialau.org/software" class="external-link uri">http://www.olivialau.org/software</a>.</p>
<p>Rosen et al, “Bayesian and Frequentist Inference for Ecological Inference: The RxC Case.” <em>Statistica Neerlandica</em>, 55:2, pp 134-156, 2001.</p>
<p>Useful documentation also avalaible at <a href="http://gking.harvard.Edu" class="external-link uri">http://gking.harvard.Edu</a>.</p>
<p>For R language see <a href="http://www.r-project.org" class="external-link uri">http://www.r-project.org</a>.</p>
<p>Venables, W.N.,and Ripley, B.D., <em>Statistics and Computing</em>, Springer (2002).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Gary King, Molly Roberts.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
